<!DOCTYPE html>

<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#0a0e1a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="OPS360">
<script>
// â”€â”€ INLINE MANIFEST â”€â”€
window.addEventListener('DOMContentLoaded',()=>{
  const m={"name":"OPS360 â€” Globales Einsatz-Management","short_name":"OPS360","start_url":".","display":"standalone","background_color":"#080c18","theme_color":"#f59e0b","icons":[]};
  const b=new Blob([JSON.stringify(m)],{type:'application/manifest+json'});
  const l=document.createElement('link');l.rel='manifest';l.href=URL.createObjectURL(b);document.head.appendChild(l);
});
// â”€â”€ INLINE SERVICE WORKER â”€â”€
if('serviceWorker' in navigator){
  window.addEventListener('load',()=>{
    const sw=`self.addEventListener('install',e=>self.skipWaiting());self.addEventListener('activate',e=>self.clients.claim());self.addEventListener('fetch',e=>{e.respondWith(fetch(e.request).catch(()=>new Response('Offline')));});`;
    const b=new Blob([sw],{type:'text/javascript'});
    navigator.serviceWorker.register(URL.createObjectURL(b),{scope:'/'}).catch(()=>{});
  });
}
</script>
<title>OPS360 â€” Globales Einsatz-Management</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Barlow+Condensed:wght@300;400;500;600;700;900&family=Barlow:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #080c18;
  --bg2: #0d1225;
  --bg3: #111830;
  --panel: #141c35;
  --panel2: #1a2340;
  --border: #1e2d50;
  --border2: #253563;
  --amber: #f59e0b;
  --amber2: #fbbf24;
  --amber-dim: rgba(245,158,11,0.15);
  --amber-glow: rgba(245,158,11,0.08);
  --green: #10b981;
  --green-dim: rgba(16,185,129,0.15);
  --red: #ef4444;
  --red-dim: rgba(239,68,68,0.15);
  --blue: #3b82f6;
  --blue-dim: rgba(59,130,246,0.15);
  --cyan: #06b6d4;
  --text: #e2e8f0;
  --text2: #94a3b8;
  --text3: #64748b;
  --radius: 4px;
  --radius2: 8px;
  --shadow: 0 4px 24px rgba(0,0,0,0.5);
  --transition: 0.2s ease;
}

- { margin: 0; padding: 0; box-sizing: border-box; }

body {
font-family: â€˜Barlowâ€™, sans-serif;
background: var(â€“bg);
color: var(â€“text);
min-height: 100vh;
overflow-x: hidden;
}

/* â”€â”€ SCROLLBAR â”€â”€ */
::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: var(â€“bg2); }
::-webkit-scrollbar-thumb { background: var(â€“border2); border-radius: 3px; }

/* â”€â”€ TOPBAR â”€â”€ */
.topbar {
position: fixed; top: 0; left: 0; right: 0; z-index: 100;
height: 56px;
background: var(â€“bg2);
border-bottom: 1px solid var(â€“border);
display: flex; align-items: center; padding: 0 20px;
gap: 20px;
}
.logo {
font-family: â€˜Space Monoâ€™, monospace;
font-size: 1.1rem; font-weight: 700;
color: var(â€“amber);
letter-spacing: 2px;
display: flex; align-items: center; gap: 10px;
white-space: nowrap;
}
.logo-icon {
width: 32px; height: 32px;
background: var(â€“amber);
border-radius: 50%;
display: flex; align-items: center; justify-content: center;
position: relative;
}
.logo-icon::after {
content: â€˜â€™;
width: 14px; height: 14px;
border: 2px solid var(â€“bg);
border-radius: 50%;
}
.logo-sub {
font-family: â€˜Barlow Condensedâ€™, sans-serif;
font-size: 0.65rem; letter-spacing: 4px;
color: var(â€“text3); font-weight: 400;
margin-top: -4px;
}
.topbar-center { flex: 1; }
.clock {
font-family: â€˜Space Monoâ€™, monospace;
font-size: 0.8rem; color: var(â€“text2);
letter-spacing: 2px;
}
.topbar-right { display: flex; align-items: center; gap: 12px; }
.status-dot {
width: 8px; height: 8px; border-radius: 50%;
background: var(â€“green);
box-shadow: 0 0 8px var(â€“green);
animation: pulse 2s infinite;
}
@keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:0.4; } }
.topbar-btn {
background: var(â€“panel);
border: 1px solid var(â€“border);
color: var(â€“text2);
padding: 6px 12px;
border-radius: var(â€“radius);
font-family: â€˜Barlow Condensedâ€™, sans-serif;
font-size: 0.8rem; letter-spacing: 1px;
cursor: pointer;
transition: var(â€“transition);
}
.topbar-btn:hover { border-color: var(â€“amber); color: var(â€“amber); }

/* â”€â”€ SIDEBAR â”€â”€ */
.sidebar {
position: fixed; top: 56px; left: 0; bottom: 0;
width: 220px;
background: var(â€“bg2);
border-right: 1px solid var(â€“border);
overflow-y: auto; z-index: 90;
transition: transform 0.3s ease;
}
.nav-section { padding: 16px 12px 8px; }
.nav-label {
font-family: â€˜Space Monoâ€™, monospace;
font-size: 0.55rem; letter-spacing: 3px;
color: var(â€“text3); text-transform: uppercase;
margin-bottom: 8px; padding: 0 8px;
}
.nav-item {
display: flex; align-items: center; gap: 10px;
padding: 9px 12px;
border-radius: var(â€“radius);
cursor: pointer;
transition: var(â€“transition);
font-family: â€˜Barlow Condensedâ€™, sans-serif;
font-size: 0.9rem; letter-spacing: 0.5px; font-weight: 500;
color: var(â€“text2);
border: 1px solid transparent;
position: relative;
}
.nav-item:hover { background: var(â€“panel); color: var(â€“text); }
.nav-item.active {
background: var(â€“amber-dim);
border-color: var(â€“border2);
color: var(â€“amber);
}
.nav-item.active::before {
content: â€˜â€™;
position: absolute; left: 0; top: 4px; bottom: 4px;
width: 3px; background: var(â€“amber);
border-radius: 0 2px 2px 0;
}
.nav-icon { font-size: 1rem; width: 20px; text-align: center; }
.nav-badge {
margin-left: auto;
background: var(â€“amber);
color: var(â€“bg);
font-size: 0.6rem; font-weight: 700;
padding: 1px 5px; border-radius: 10px;
font-family: â€˜Space Monoâ€™, monospace;
}

/* â”€â”€ MAIN â”€â”€ */
.main {
margin-left: 220px; margin-top: 56px;
padding: 24px;
min-height: calc(100vh - 56px);
}

/* â”€â”€ VIEWS â”€â”€ */
.view { display: none; animation: fadeIn 0.3s ease; }
.view.active { display: block; }
@keyframes fadeIn { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }

/* â”€â”€ PAGE HEADER â”€â”€ */
.page-header {
display: flex; align-items: flex-end; justify-content: space-between;
margin-bottom: 24px;
}
.page-title {
font-family: â€˜Barlow Condensedâ€™, sans-serif;
font-size: 2rem; font-weight: 700;
letter-spacing: 1px;
line-height: 1;
}
.page-title span { color: var(â€“amber); }
.page-sub {
font-size: 0.8rem; color: var(â€“text3);
margin-top: 4px; letter-spacing: 1px;
font-family: â€˜Space Monoâ€™, monospace;
}

/* â”€â”€ BUTTONS â”€â”€ */
.btn {
display: inline-flex; align-items: center; gap: 6px;
padding: 8px 16px;
border-radius: var(â€“radius);
font-family: â€˜Barlow Condensedâ€™, sans-serif;
font-size: 0.85rem; letter-spacing: 1px; font-weight: 600;
cursor: pointer; border: none;
transition: var(â€“transition);
}
.btn-primary { background: var(â€“amber); color: var(â€“bg); }
.btn-primary:hover { background: var(â€“amber2); transform: translateY(-1px); }
.btn-outline {
background: transparent; color: var(â€“amber);
border: 1px solid var(â€“amber);
}
.btn-outline:hover { background: var(â€“amber-dim); }
.btn-ghost {
background: var(â€“panel); color: var(â€“text2);
border: 1px solid var(â€“border);
}
.btn-ghost:hover { border-color: var(â€“border2); color: var(â€“text); }
.btn-danger { background: var(â€“red); color: white; }
.btn-success { background: var(â€“green); color: var(â€“bg); }
.btn-sm { padding: 5px 10px; font-size: 0.75rem; }

/* â”€â”€ GRID â”€â”€ */
.grid-4 { display: grid; grid-template-columns: repeat(4,1fr); gap: 16px; }
.grid-3 { display: grid; grid-template-columns: repeat(3,1fr); gap: 16px; }
.grid-2 { display: grid; grid-template-columns: repeat(2,1fr); gap: 16px; }
.grid-12 { display: grid; grid-template-columns: 1fr 2fr; gap: 20px; }
.grid-21 { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }

/* â”€â”€ CARDS â”€â”€ */
.card {
background: var(â€“panel);
border: 1px solid var(â€“border);
border-radius: var(â€“radius2);
padding: 20px;
}
.card-header {
display: flex; align-items: center; justify-content: space-between;
margin-bottom: 16px;
}
.card-title {
font-family: â€˜Barlow Condensedâ€™, sans-serif;
font-size: 0.75rem; letter-spacing: 3px;
color: var(â€“text3); text-transform: uppercase; font-weight: 600;
}

/* â”€â”€ KPI CARDS â”€â”€ */
.kpi-card {
background: var(â€“panel);
border: 1px solid var(â€“border);
border-radius: var(â€“radius2);
padding: 20px;
position: relative; overflow: hidden;
transition: var(â€“transition);
}
.kpi-card:hover { border-color: var(â€“border2); transform: translateY(-2px); }
.kpi-card::before {
content: â€˜â€™;
position: absolute; top: 0; left: 0; right: 0; height: 2px;
}
.kpi-card.amber::before { background: var(â€“amber); }
.kpi-card.green::before { background: var(â€“green); }
.kpi-card.blue::before { background: var(â€“blue); }
.kpi-card.red::before { background: var(â€“red); }
.kpi-label {
font-family: â€˜Space Monoâ€™, monospace;
font-size: 0.6rem; letter-spacing: 2px;
color: var(â€“text3); text-transform: uppercase;
}
.kpi-value {
font-family: â€˜Barlow Condensedâ€™, sans-serif;
font-size: 2.4rem; font-weight: 900;
line-height: 1; margin: 8px 0 4px;
}
.kpi-card.amber .kpi-value { color: var(â€“amber); }
.kpi-card.green .kpi-value { color: var(â€“green); }
.kpi-card.blue .kpi-value { color: var(â€“blue); }
.kpi-card.red .kpi-value { color: var(â€“red); }
.kpi-sub { font-size: 0.75rem; color: var(â€“text3); }
.kpi-icon {
position: absolute; right: 16px; top: 16px;
font-size: 2rem; opacity: 0.15;
}

/* â”€â”€ TABLE â”€â”€ */
.table-wrap { overflow-x: auto; }
table { width: 100%; border-collapse: collapse; }
th {
text-align: left;
font-family: â€˜Space Monoâ€™, monospace;
font-size: 0.55rem; letter-spacing: 2px;
color: var(â€“text3); text-transform: uppercase;
padding: 8px 12px;
border-bottom: 1px solid var(â€“border);
}
td {
padding: 10px 12px;
font-size: 0.85rem;
border-bottom: 1px solid var(â€“border);
vertical-align: middle;
}
tr:last-child td { border-bottom: none; }
tr:hover td { background: var(â€“panel2); }

/* â”€â”€ BADGES â”€â”€ */
.badge {
display: inline-block;
padding: 2px 8px;
border-radius: 100px;
font-size: 0.7rem; font-weight: 600;
font-family: â€˜Barlow Condensedâ€™, sans-serif;
letter-spacing: 0.5px;
}
.badge-amber { background: var(â€“amber-dim); color: var(â€“amber); border: 1px solid rgba(245,158,11,0.3); }
.badge-green { background: var(â€“green-dim); color: var(â€“green); border: 1px solid rgba(16,185,129,0.3); }
.badge-red { background: var(â€“red-dim); color: var(â€“red); border: 1px solid rgba(239,68,68,0.3); }
.badge-blue { background: var(â€“blue-dim); color: var(â€“blue); border: 1px solid rgba(59,130,246,0.3); }
.badge-gray { background: rgba(100,116,139,0.2); color: var(â€“text3); border: 1px solid rgba(100,116,139,0.3); }

/* â”€â”€ FORMS â”€â”€ */
.form-group { margin-bottom: 16px; }
.form-label {
display: block;
font-family: â€˜Space Monoâ€™, monospace;
font-size: 0.6rem; letter-spacing: 2px;
color: var(â€“text3); text-transform: uppercase;
margin-bottom: 6px;
}
.form-control {
width: 100%;
background: var(â€“bg3);
border: 1px solid var(â€“border);
border-radius: var(â€“radius);
color: var(â€“text);
padding: 9px 12px;
font-family: â€˜Barlowâ€™, sans-serif;
font-size: 0.9rem;
transition: var(â€“transition);
outline: none;
}
.form-control:focus { border-color: var(â€“amber); box-shadow: 0 0 0 2px var(â€“amber-dim); }
.form-control::placeholder { color: var(â€“text3); }
select.form-control option { background: var(â€“bg3); }
.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
.form-row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }

/* â”€â”€ PROGRESS â”€â”€ */
.progress-bar {
height: 4px; background: var(â€“border);
border-radius: 2px; overflow: hidden;
margin-top: 8px;
}
.progress-fill {
height: 100%; border-radius: 2px;
transition: width 0.6s ease;
}

/* â”€â”€ TIMELINE â”€â”€ */
.timeline { position: relative; padding-left: 24px; }
.timeline::before {
content: â€˜â€™;
position: absolute; left: 8px; top: 0; bottom: 0;
width: 1px; background: var(â€“border);
}
.timeline-item { position: relative; margin-bottom: 20px; }
.timeline-dot {
position: absolute; left: -20px; top: 4px;
width: 10px; height: 10px; border-radius: 50%;
border: 2px solid;
}
.timeline-dot.amber { border-color: var(â€“amber); background: var(â€“amber-dim); }
.timeline-dot.green { border-color: var(â€“green); background: var(â€“green-dim); }
.timeline-dot.blue { border-color: var(â€“blue); background: var(â€“blue-dim); }
.timeline-dot.gray { border-color: var(â€“border2); background: var(â€“border); }
.timeline-time {
font-family: â€˜Space Monoâ€™, monospace;
font-size: 0.6rem; color: var(â€“text3);
margin-bottom: 2px;
}
.timeline-title { font-size: 0.85rem; font-weight: 600; }
.timeline-desc { font-size: 0.8rem; color: var(â€“text2); margin-top: 2px; }

/* â”€â”€ MODAL â”€â”€ */
.modal-overlay {
display: none; position: fixed; inset: 0; z-index: 200;
background: rgba(8,12,24,0.85);
backdrop-filter: blur(4px);
align-items: center; justify-content: center;
}
.modal-overlay.open { display: flex; }
.modal {
background: var(â€“panel);
border: 1px solid var(â€“border2);
border-radius: var(â€“radius2);
width: 90%; max-width: 780px; max-height: 90vh;
overflow-y: auto;
box-shadow: 0 24px 80px rgba(0,0,0,0.8);
animation: modalIn 0.25s ease;
}
@keyframes modalIn { from { transform: scale(0.95); opacity:0; } to { transform:scale(1); opacity:1; } }
.modal-header {
padding: 20px 24px;
border-bottom: 1px solid var(â€“border);
display: flex; align-items: center; justify-content: space-between;
}
.modal-title {
font-family: â€˜Barlow Condensedâ€™, sans-serif;
font-size: 1.2rem; font-weight: 700; letter-spacing: 1px;
}
.modal-close {
background: none; border: none; color: var(â€“text3);
font-size: 1.2rem; cursor: pointer;
transition: var(â€“transition);
}
.modal-close:hover { color: var(â€“red); }
.modal-body { padding: 24px; }
.modal-footer {
padding: 16px 24px;
border-top: 1px solid var(â€“border);
display: flex; gap: 10px; justify-content: flex-end;
}

/* â”€â”€ MAP PLACEHOLDER â”€â”€ */
.world-map {
background: var(â€“bg3);
border: 1px solid var(â€“border);
border-radius: var(â€“radius2);
height: 260px;
position: relative; overflow: hidden;
display: flex; align-items: center; justify-content: center;
}
.world-map svg { width: 100%; height: 100%; opacity: 0.6; }
.map-dot {
position: absolute;
width: 10px; height: 10px; border-radius: 50%;
background: var(â€“amber);
box-shadow: 0 0 12px var(â€“amber);
animation: pulse 2s infinite;
}
.map-label {
position: absolute;
font-family: â€˜Space Monoâ€™, monospace;
font-size: 0.55rem; color: var(â€“amber);
white-space: nowrap;
margin-top: 12px;
}

/* â”€â”€ ALERT â”€â”€ */
.alert {
padding: 12px 16px;
border-radius: var(â€“radius);
display: flex; align-items: flex-start; gap: 10px;
margin-bottom: 12px;
font-size: 0.85rem;
}
.alert-amber { background: var(â€“amber-dim); border: 1px solid rgba(245,158,11,0.3); color: var(â€“amber2); }
.alert-green { background: var(â€“green-dim); border: 1px solid rgba(16,185,129,0.3); color: var(â€“green); }
.alert-red { background: var(â€“red-dim); border: 1px solid rgba(239,68,68,0.3); color: var(â€“red); }

/* â”€â”€ SERVICE GRID â”€â”€ */
.service-card {
background: var(â€“panel);
border: 1px solid var(â€“border);
border-radius: var(â€“radius2);
padding: 16px;
display: flex; flex-direction: column; gap: 10px;
transition: var(â€“transition);
}
.service-card:hover { border-color: var(â€“border2); }
.service-icon { font-size: 1.8rem; }
.service-name {
font-family: â€˜Barlow Condensedâ€™, sans-serif;
font-size: 0.9rem; font-weight: 600; letter-spacing: 0.5px;
}
.service-count { font-size: 0.75rem; color: var(â€“text3); }
.service-status { display: flex; align-items: center; gap: 6px; font-size: 0.75rem; }

/* â”€â”€ DEPT TABS â”€â”€ */
.dept-tabs { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
.dept-tab {
padding: 7px 16px;
border-radius: var(â€“radius);
border: 1px solid var(â€“border);
background: var(â€“panel);
color: var(â€“text2);
cursor: pointer;
font-family: â€˜Barlow Condensedâ€™, sans-serif;
font-size: 0.85rem; letter-spacing: 0.5px; font-weight: 500;
transition: var(â€“transition);
}
.dept-tab:hover { border-color: var(â€“border2); }
.dept-tab.active { background: var(â€“amber-dim); border-color: var(â€“amber); color: var(â€“amber); }

/* â”€â”€ STEP INDICATOR â”€â”€ */
.steps { display: flex; align-items: center; gap: 0; margin-bottom: 24px; }
.step { display: flex; align-items: center; gap: 8px; }
.step-num {
width: 28px; height: 28px; border-radius: 50%;
display: flex; align-items: center; justify-content: center;
font-family: â€˜Space Monoâ€™, monospace; font-size: 0.7rem;
border: 2px solid var(â€“border2); color: var(â€“text3);
}
.step.done .step-num { background: var(â€“green); border-color: var(â€“green); color: var(â€“bg); }
.step.active .step-num { background: var(â€“amber); border-color: var(â€“amber); color: var(â€“bg); }
.step-label { font-size: 0.8rem; color: var(â€“text3); font-family: â€˜Barlow Condensedâ€™, sans-serif; letter-spacing: 0.5px; }
.step.active .step-label { color: var(â€“amber); }
.step.done .step-label { color: var(â€“green); }
.step-line { flex: 1; height: 1px; background: var(â€“border); min-width: 20px; }
.step-line.done { background: var(â€“green); }

/* â”€â”€ PRINT â”€â”€ */
@media print {
.sidebar, .topbar, .no-print { display: none !important; }
.main { margin: 0; }
}

/* â”€â”€ RESPONSIVE â”€â”€ */
@media (max-width: 900px) {
.sidebar { transform: translateX(-100%); }
.sidebar.open { transform: translateX(0); }
.main { margin-left: 0; }
.grid-4 { grid-template-columns: repeat(2,1fr); }
.grid-3 { grid-template-columns: 1fr; }
.grid-12, .grid-21 { grid-template-columns: 1fr; }
}

/* â”€â”€ TOAST â”€â”€ */
.toast-container {
position: fixed; bottom: 20px; right: 20px;
z-index: 999; display: flex; flex-direction: column; gap: 8px;
}
.toast {
background: var(â€“panel2);
border: 1px solid var(â€“border2);
border-radius: var(â€“radius);
padding: 12px 16px;
font-size: 0.85rem;
min-width: 260px;
animation: toastIn 0.3s ease;
display: flex; align-items: center; gap: 10px;
}
@keyframes toastIn { from { transform: translateX(100%); opacity:0; } to { transform:translateX(0); opacity:1; } }

/* â”€â”€ SLIDER â”€â”€ */
.slider-wrap { display: flex; align-items: center; gap: 12px; }
input[type=range] {
flex: 1; accent-color: var(â€“amber);
background: var(â€“border); height: 4px; border-radius: 2px;
}
.slider-val {
font-family: â€˜Space Monoâ€™, monospace;
font-size: 0.8rem; color: var(â€“amber);
min-width: 50px; text-align: right;
}

/* â”€â”€ DONUT CHART â”€â”€ */
.donut-wrap { display: flex; align-items: center; gap: 20px; }
.donut-legend { display: flex; flex-direction: column; gap: 8px; }
.legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.8rem; }
.legend-dot { width: 8px; height: 8px; border-radius: 50%; }

/* â”€â”€ CALENDAR STRIP â”€â”€ */
.cal-strip { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 4px; }
.cal-day {
min-width: 52px; padding: 8px;
background: var(â€“panel); border: 1px solid var(â€“border);
border-radius: var(â€“radius); text-align: center;
cursor: pointer; transition: var(â€“transition);
}
.cal-day:hover { border-color: var(â€“border2); }
.cal-day.active { background: var(â€“amber-dim); border-color: var(â€“amber); }
.cal-day.has-event { border-color: var(â€“blue); }
.cal-day-num { font-family: â€˜Space Monoâ€™, monospace; font-size: 0.85rem; font-weight: 700; }
.cal-day-name { font-size: 0.65rem; color: var(â€“text3); }
.cal-event-dot { width: 4px; height: 4px; border-radius: 50%; background: var(â€“blue); margin: 2px auto 0; }

/* Utility */
.mt8 { margin-top: 8px; }
.mt12 { margin-top: 12px; }
.mt16 { margin-top: 16px; }
.mt20 { margin-top: 20px; }
.mb8 { margin-bottom: 8px; }
.mb12 { margin-bottom: 12px; }
.mb16 { margin-bottom: 16px; }
.flex { display: flex; }
.items-center { align-items: center; }
.justify-between { justify-content: space-between; }
.gap8 { gap: 8px; }
.gap12 { gap: 12px; }
.gap16 { gap: 16px; }
.text-amber { color: var(â€“amber); }
.text-green { color: var(â€“green); }
.text-red { color: var(â€“red); }
.text-blue { color: var(â€“blue); }
.text-muted { color: var(â€“text3); }
.text-sm { font-size: 0.8rem; }
.text-xs { font-size: 0.7rem; }
.font-mono { font-family: â€˜Space Monoâ€™, monospace; }
.font-cond { font-family: â€˜Barlow Condensedâ€™, sans-serif; }
.fw7 { font-weight: 700; }
.w-full { width: 100%; }
.separator { border: none; border-top: 1px solid var(â€“border); margin: 20px 0; }
</style>

</head>
<body>

<!-- TOPBAR -->

<div class="topbar">
  <div class="logo">
    <div class="logo-icon"></div>
    <div>
      OPS360
      <div class="logo-sub">GLOBAL OPERATIONS</div>
    </div>
  </div>
  <button class="topbar-btn" onclick="toggleSidebar()" style="display:none" id="menuBtn">â˜°</button>
  <div class="topbar-center">
    <div style="display:flex;align-items:center;gap:8px;">
      <div class="clock" id="clock">--:--:-- UTC</div>
      <button onclick="openModal('timeModal')" title="Zeit anpassen" style="background:none;border:none;color:var(--text3);cursor:pointer;font-size:0.8rem;padding:2px 6px;border-radius:4px;transition:0.2s;" onmouseover="this.style.color='var(--amber)'" onmouseout="this.style.color='var(--text3)'">âœï¸</button>
    </div>
  </div>
  <div class="topbar-right">
    <span class="status-dot"></span>
    <span class="text-sm text-muted">SYSTEM AKTIV</span>
    <button class="topbar-btn" onclick="showToast('âœ… Alle Daten gesichert','green')">ğŸ’¾ Speichern</button>
    <button class="topbar-btn" onclick="downloadApp()" style="background:var(--amber-dim);border-color:var(--amber);color:var(--amber);">â¬‡ï¸ Datei speichern</button>
    <button class="topbar-btn" onclick="openModal('exportModal')">ğŸ“¤ Export</button>
  </div>
</div>

<!-- SIDEBAR -->

<div class="sidebar" id="sidebar">
  <div class="nav-section">
    <div class="nav-label">Ãœbersicht</div>
    <div class="nav-item active" onclick="showView('dashboard')">
      <span class="nav-icon">ğŸ“Š</span> Dashboard
    </div>
    <div class="nav-item" onclick="showView('karte')">
      <span class="nav-icon">ğŸŒ</span> Weltkarte
    </div>
    <div class="nav-item" onclick="showView('kalender')">
      <span class="nav-icon">ğŸ“…</span> Kalender
    </div>
  </div>
  <div class="nav-section">
    <div class="nav-label">Anforderungen</div>
    <div class="nav-item" onclick="showView('bedarfsanforderung')">
      <span class="nav-icon">ğŸ“‹</span> Bedarfsanforderung
      <span class="nav-badge" id="bdBadge">3</span>
    </div>
    <div class="nav-item" onclick="showView('abteilungen')">
      <span class="nav-icon">ğŸ¢</span> Abteilungen
    </div>
  </div>
  <div class="nav-section">
    <div class="nav-label">Einsatzphasen</div>
    <div class="nav-item" onclick="showView('phase1')">
      <span class="nav-icon">ğŸšš</span> Phase 1 â€” Transit
    </div>
    <div class="nav-item" onclick="showView('phase2')">
      <span class="nav-icon">ğŸ•ï¸</span> Phase 2 â€” Final Location
    </div>
  </div>
  <div class="nav-section">
    <div class="nav-label">Services</div>
    <div class="nav-item" onclick="showView('services')">
      <span class="nav-icon">âš™ï¸</span> Service-Ãœbersicht
    </div>
    <div class="nav-item" onclick="showView('personal')">
      <span class="nav-icon">ğŸ‘¥</span> Personal (20â€“1500)
    </div>
    <div class="nav-item" onclick="showView('transport')">
      <span class="nav-icon">ğŸš›</span> Transport & FlÃ¤chen
    </div>
  </div>
  <div class="nav-section">
    <div class="nav-label">Verwaltung</div>
    <div class="nav-item" onclick="showView('abrechnung')">
      <span class="nav-icon">ğŸ’°</span> Abrechnung
    </div>
    <div class="nav-item" onclick="showView('partner')">
      <span class="nav-icon">ğŸ¤</span> BehÃ¶rden / Partner
    </div>
    <div class="nav-item" onclick="showView('vorlagen')">
      <span class="nav-icon">ğŸ“„</span> Vorlagen & Dokumente
    </div>
    <div class="nav-item" onclick="showView('einstellungen')">
      <span class="nav-icon">âš™ï¸</span> Einstellungen
    </div>
  </div>
</div>

<!-- MAIN CONTENT -->

<div class="main">

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     DASHBOARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div class="view active" id="view-dashboard">
  <div class="page-header">
    <div>
      <div class="page-title">Dashboard <span>Ãœbersicht</span></div>
      <div class="page-sub">Stand: <span id="dashDate">--</span> Â· 360Â° Global Operations</div>
    </div>
    <div class="flex gap8">
      <button class="btn btn-ghost btn-sm" onclick="showView('bedarfsanforderung')">+ Neue Anforderung</button>
      <button class="btn btn-primary btn-sm" onclick="openModal('alertModal')">ğŸ”” Meldungen (2)</button>
    </div>
  </div>

  <!-- KPIs -->

  <div class="grid-4 mb16">
    <div class="kpi-card amber">
      <div class="kpi-icon">ğŸ‘¥</div>
      <div class="kpi-label">Personal im Einsatz</div>
      <div class="kpi-value" id="kpiPersonal">347</div>
      <div class="kpi-sub">+42 geplant nÃ¤chste 7 Tage</div>
    </div>
    <div class="kpi-card green">
      <div class="kpi-icon">ğŸŒ</div>
      <div class="kpi-label">Aktive Standorte</div>
      <div class="kpi-value" id="kpiStandorte">8</div>
      <div class="kpi-sub">in 6 LÃ¤ndern</div>
    </div>
    <div class="kpi-card blue">
      <div class="kpi-icon">ğŸ“‹</div>
      <div class="kpi-label">Offene Anforderungen</div>
      <div class="kpi-value" id="kpiAnforderungen">12</div>
      <div class="kpi-sub">3 dringend Â· 30-Tage-Vorlauf</div>
    </div>
    <div class="kpi-card red">
      <div class="kpi-icon">âš ï¸</div>
      <div class="kpi-label">Offene Aktionen</div>
      <div class="kpi-value" id="kpiAktionen">5</div>
      <div class="kpi-sub">Freigaben erforderlich</div>
    </div>
  </div>

  <div class="grid-21 mb16">
    <!-- Aktive EinsÃ¤tze -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">Aktive EinsÃ¤tze</div>
        <div class="flex gap8">
          <span class="badge badge-amber">Phase 1: 3</span>
          <span class="badge badge-green">Phase 2: 5</span>
        </div>
      </div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Einsatz-ID</th>
              <th>Land / Standort</th>
              <th>Phase</th>
              <th>Personal</th>
              <th>LKW/PKW</th>
              <th>Status</th>
              <th>Aktion</th>
            </tr>
          </thead>
          <tbody id="einsatzTable">
            <!-- filled by JS -->
          </tbody>
        </table>
      </div>
    </div>
    <!-- Sidebar right -->
    <div class="flex" style="flex-direction:column; gap:16px;">
      <div class="card">
        <div class="card-header">
          <div class="card-title">Abteilungen (30 Tage)</div>
        </div>
        <div style="display:flex; flex-direction:column; gap:10px;">
          <div id="deptProgress"></div>
        </div>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">AktivitÃ¤ten</div>
        </div>
        <div class="timeline" id="activityTimeline"></div>
      </div>
    </div>
  </div>

  <!-- Alerts -->

  <div class="card">
    <div class="card-header"><div class="card-title">âš ï¸ Aktuelle Hinweise</div></div>
    <div id="dashAlerts"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     BEDARFSANFORDERUNG
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div class="view" id="view-bedarfsanforderung">
  <div class="page-header">
    <div>
      <div class="page-title">Bedarfs<span>anforderung</span></div>
      <div class="page-sub">Vorlage fÃ¼r alle 5 Abteilungen Â· 30-Tage-Vorlauf</div>
    </div>
    <div class="flex gap8">
      <button class="btn btn-ghost btn-sm" onclick="printForm()">ğŸ–¨ï¸ Drucken / PDF</button>
      <button class="btn btn-primary" onclick="submitBedarfsanforderung()">âœ… Einreichen</button>
    </div>
  </div>

  <!-- Department selector -->

  <div class="dept-tabs mb16" id="deptTabs">
    <div class="dept-tab active" onclick="selectDept(this,'ABT-1')">ABT-1: Planung</div>
    <div class="dept-tab" onclick="selectDept(this,'ABT-2')">ABT-2: Logistik</div>
    <div class="dept-tab" onclick="selectDept(this,'ABT-3')">ABT-3: Technik</div>
    <div class="dept-tab" onclick="selectDept(this,'ABT-4')">ABT-4: Infrastruktur</div>
    <div class="dept-tab" onclick="selectDept(this,'ABT-5')">ABT-5: Support</div>
  </div>

  <!-- Step indicator -->

  <div class="steps mb16">
    <div class="step active" id="step1"><div class="step-num">1</div><div class="step-label">Stammdaten</div></div>
    <div class="step-line" id="line12"></div>
    <div class="step" id="step2"><div class="step-num">2</div><div class="step-label">Personal</div></div>
    <div class="step-line" id="line23"></div>
    <div class="step" id="step3"><div class="step-num">3</div><div class="step-label">Services</div></div>
    <div class="step-line" id="line34"></div>
    <div class="step" id="step4"><div class="step-num">4</div><div class="step-label">Transport</div></div>
    <div class="step-line" id="line45"></div>
    <div class="step" id="step5"><div class="step-num">5</div><div class="step-label">Freigabe</div></div>
  </div>

  <div id="formStep1">
  <div class="grid-2">
    <div class="card">
      <div class="card-header"><div class="card-title">Stammdaten</div></div>
      <div class="form-group">
        <label class="form-label">Anforderungs-ID</label>
        <input class="form-control" id="bdId" value="" placeholder="Wird automatisch vergeben" readonly style="color:var(--amber)">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Abteilung</label>
          <select class="form-control" id="bdAbt">
            <option>ABT-1: Planung</option>
            <option>ABT-2: Logistik</option>
            <option>ABT-3: Technik</option>
            <option>ABT-4: Infrastruktur</option>
            <option>ABT-5: Support</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Einsatz-Phase</label>
          <select class="form-control" id="bdPhase">
            <option value="1">Phase 1 â€” Transit</option>
            <option value="2">Phase 2 â€” Final Location</option>
            <option value="both">Phase 1 + 2</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Anforderungsdatum</label>
          <input type="date" class="form-control" id="bdDatum">
        </div>
        <div class="form-group">
          <label class="form-label">Einsatzbeginn (geplant)</label>
          <input type="date" class="form-control" id="bdBeginn">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Einsatzende (geplant)</label>
          <input type="date" class="form-control" id="bdEnde">
        </div>
        <div class="form-group">
          <label class="form-label">PrioritÃ¤t</label>
          <select class="form-control" id="bdPrio">
            <option>Normal</option>
            <option>ErhÃ¶ht</option>
            <option>Dringend</option>
            <option>Kritisch</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Zielregion / Land</label>
        <select class="form-control" id="bdLand">
          <option>--- Europa ---</option>
          <option>Deutschland</option>
          <option>Frankreich</option>
          <option>Polen</option>
          <option>Niederlande</option>
          <option>Belgien</option>
          <option>Spanien</option>
          <option>Italien</option>
          <option>Schweden</option>
          <option>Norwegen</option>
          <option>Ã–sterreich</option>
          <option>Schweiz</option>
          <option>Tschechien</option>
          <option>--- Global ---</option>
          <option>USA</option>
          <option>Kanada</option>
          <option>VAE</option>
          <option>Katar</option>
          <option>Australien</option>
          <option>Sonstiges</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Genauer Standort / Adresse</label>
        <input class="form-control" id="bdStandort" placeholder="StraÃŸe, Stadt, Koordinaten...">
      </div>
      <div class="form-group">
        <label class="form-label">Einsatzbeschreibung</label>
        <textarea class="form-control" id="bdBeschreibung" rows="3" placeholder="Kurze Beschreibung des Einsatzzwecks..."></textarea>
      </div>
    </div>
    <div class="card">
      <div class="card-header"><div class="card-title">Ansprechpartner</div></div>
      <div class="form-group">
        <label class="form-label">Anfordernder (Name)</label>
        <input class="form-control" id="bdAnforderer" placeholder="Vor- und Nachname">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Telefon</label>
          <input class="form-control" id="bdTel" type="tel" placeholder="+49...">
        </div>
        <div class="form-group">
          <label class="form-label">E-Mail</label>
          <input class="form-control" id="bdMail" type="email" placeholder="name@firma.de">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Einsatzleiter vor Ort</label>
        <input class="form-control" id="bdLeiter" placeholder="Name des Einsatzleiters">
      </div>
      <div class="form-group">
        <label class="form-label">Kostenstellencode</label>
        <input class="form-control" id="bdKosten" placeholder="KST-XXXX">
      </div>
      <div class="form-group">
        <label class="form-label">Budget (EUR)</label>
        <input class="form-control" id="bdBudget" type="number" placeholder="0,00">
      </div>
      <div class="form-group">
        <label class="form-label">Staatliche Genehmigung / BehÃ¶rde</label>
        <input class="form-control" id="bdBehoerde" placeholder="Name der BehÃ¶rde, Aktenzeichen">
      </div>
      <div class="form-group">
        <label class="form-label">Sicherheitsklassifizierung</label>
        <select class="form-control" id="bdSicherheit">
          <option>OFFEN</option>
          <option>VS-NfD</option>
          <option>VERTRAULICH</option>
          <option>GEHEIM</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Bemerkungen / Besonderheiten</label>
        <textarea class="form-control" id="bdBemerkung" rows="3" placeholder="Besondere Anforderungen, EinschrÃ¤nkungen..."></textarea>
      </div>
    </div>
  </div>
  </div>

  <div id="formStep2" style="display:none">
  <div class="card">
    <div class="card-header">
      <div class="card-title">Personalplanung</div>
      <button class="btn btn-ghost btn-sm" onclick="addPersonRow()">+ Person hinzufÃ¼gen</button>
    </div>
    <div class="alert alert-amber">âš ï¸ KapazitÃ¤tsbereich: 20 bis 5.000 Mitarbeiter</div>

```
<!-- Einzelpersonen-Tabelle -->
<div class="mb16">
  <div class="card-title mb8" style="margin-bottom:10px;">Personenliste</div>
  <div class="table-wrap">
    <table id="personTable">
      <thead>
        <tr>
          <th>Nachname</th>
          <th>Vorname</th>
          <th>Personal-ID</th>
          <th>Abteilung</th>
          <th>Funktion</th>
          <th>Aktion</th>
        </tr>
      </thead>
      <tbody id="personTableBody">
        <tr>
          <td><input class="form-control" placeholder="Mustermann" style="min-width:120px"></td>
          <td><input class="form-control" placeholder="Hans" style="min-width:100px"></td>
          <td><input class="form-control" placeholder="P-0001" style="min-width:90px"></td>
          <td><select class="form-control" style="min-width:130px">
            <option>ABT-1: Planung</option><option>ABT-2: Logistik</option>
            <option>ABT-3: Technik</option><option>ABT-4: Infrastruktur</option><option>ABT-5: Support</option>
          </select></td>
          <td><input class="form-control" placeholder="Techniker" style="min-width:110px"></td>
          <td><button class="btn btn-danger btn-sm" onclick="this.closest('tr').remove()">âœ•</button></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
<hr class="separator">
<div class="card-title mb8">GesamtkapazitÃ¤t</div>
<div class="form-row-3">
  <div class="form-group">
    <label class="form-label">Gesamte Mitarbeiteranzahl</label>
    <div class="slider-wrap">
      <input type="range" min="20" max="5000" value="50" id="personalSlider" oninput="updatePersonalSlider()">
      <span class="slider-val" id="personalVal">50</span>
    </div>
    <input type="number" class="form-control mt8" id="personalInput" value="50" min="20" max="5000" oninput="syncPersonalInput()">
  </div>
  <div class="form-group">
    <label class="form-label">Davon Phase 1 (Transit)</label>
    <input type="number" class="form-control" id="pers1" value="0" min="0">
  </div>
  <div class="form-group">
    <label class="form-label">Davon Phase 2 (Final Location)</label>
    <input type="number" class="form-control" id="pers2" value="0" min="0">
  </div>
</div>
<div class="form-row-3">
  <div class="form-group">
    <label class="form-label">Offiziere / FÃ¼hrungspersonal</label>
    <input type="number" class="form-control" id="persOff" value="0" min="0">
  </div>
  <div class="form-group">
    <label class="form-label">Technisches Personal</label>
    <input type="number" class="form-control" id="persTech" value="0" min="0">
  </div>
  <div class="form-group">
    <label class="form-label">UnterstÃ¼tzungspersonal</label>
    <input type="number" class="form-control" id="persSupp" value="0" min="0">
  </div>
</div>
<div class="form-row">
  <div class="form-group">
    <label class="form-label">Unterkunftstyp</label>
    <select class="form-control" id="unterkunftTyp">
      <option>Hotel (Standard)</option>
      <option>Hotel (Business)</option>
      <option>Feldlager / Zelt</option>
      <option>Modulare GebÃ¤ude</option>
      <option>Kaserne / Quartier</option>
      <option>Mischbelegung</option>
    </select>
  </div>
  <div class="form-group">
    <label class="form-label">Zimmertyp</label>
    <select class="form-control" id="zimmerTyp">
      <option>Einzelzimmer</option>
      <option>Doppelzimmer</option>
      <option>Mehrbettzimmer (4er)</option>
      <option>Mehrbettzimmer (6er)</option>
      <option>Gemischt</option>
    </select>
  </div>
</div>
<div class="form-row">
  <div class="form-group">
    <label class="form-label">Besondere Anforderungen (Medizin / DiÃ¤t)</label>
    <textarea class="form-control" rows="2" id="persSpecial" placeholder="z.B. Vegetarisch, Diabetiker, Rollstuhlfahrer..."></textarea>
  </div>
  <div class="form-group">
    <label class="form-label">Sicherheitspersonal erforderlich?</label>
    <select class="form-control" id="persSecurity">
      <option>Nein</option>
      <option>Ja â€” Bewachung Unterkunft</option>
      <option>Ja â€” Personenschutz</option>
      <option>Ja â€” Beides</option>
    </select>
  </div>
</div>
```

  </div>
  </div>

  <div id="formStep3" style="display:none">
  <div class="card">
    <div class="card-header"><div class="card-title">Services & Versorgung</div></div>
    <div class="grid-2">
      <div>
        <div class="form-group">
          <label class="form-label">ğŸ½ï¸ Verpflegung</label>
          <select class="form-control" id="srvVerpflegung">
            <option>Vollverpflegung (3 Mahlzeiten)</option>
            <option>Halbpension</option>
            <option>Selbstversorgung mit KÃ¼chenausstattung</option>
            <option>Fertigpackungen / Feldration</option>
            <option>Keine</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Mahlzeiten / Tag</label>
          <select class="form-control" id="srvMahlzeiten">
            <option>3 (FrÃ¼hstÃ¼ck, Mittagessen, Abendessen)</option>
            <option>2 (FrÃ¼hstÃ¼ck + Mittagessen)</option>
            <option>2 (Mittagessen + Abendessen)</option>
            <option>1 Mahlzeit</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">ğŸ§º WÃ¤scheservice</label>
          <select class="form-control" id="srvWaesche">
            <option>TÃ¤glich</option>
            <option>2x pro Woche</option>
            <option>WÃ¶chentlich</option>
            <option>Nicht erforderlich</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">ğŸš½ SanitÃ¤ranlagen</label>
          <select class="form-control" id="srvSanitaer">
            <option>Vorhandene Infrastruktur nutzen</option>
            <option>Mobile Toilettenanlage</option>
            <option>SanitÃ¤rcontainer aufstellen</option>
            <option>Kombination</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Toiletten-Einheiten (Anzahl)</label>
          <input type="number" class="form-control" id="srvToiletten" value="0" min="0">
        </div>
      </div>
      <div>
        <div class="form-group">
          <label class="form-label">ğŸ—‘ï¸ Abfallentsorgung</label>
          <select class="form-control" id="srvAbfall">
            <option>Standard (wÃ¶chentlich)</option>
            <option>ErhÃ¶hter Bedarf (tÃ¤glich)</option>
            <option>Gefahrgut-Entsorgung erforderlich</option>
            <option>Getrennte Entsorgung (Recycling)</option>
            <option>Keine / Selbst organisiert</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">ğŸŒ IT & Kommunikation</label>
          <select class="form-control" id="srvIT" multiple style="height:96px">
            <option selected>WLAN-Internetzugang</option>
            <option>LAN-Festnetz</option>
            <option>Satelliten-Kommunikation</option>
            <option>VerschlÃ¼sseltes VPN</option>
            <option>BÃ¼rotelefon / Festnetz</option>
            <option>Videokonferenzsystem</option>
            <option>Drucker / Scanner</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Bandbreite (Mbit/s)</label>
          <input type="number" class="form-control" id="srvBandbreite" placeholder="z.B. 100">
        </div>
        <div class="form-group">
          <label class="form-label">Weitere Services</label>
          <div style="display:flex; flex-direction:column; gap:6px; margin-top:4px;">
            <label style="display:flex; align-items:center; gap:8px; font-size:0.85rem; cursor:pointer;">
              <input type="checkbox" id="srvMedizin"> Medizinische Versorgung / SanitÃ¤tsdienst
            </label>
            <label style="display:flex; align-items:center; gap:8px; font-size:0.85rem; cursor:pointer;">
              <input type="checkbox" id="srvWaffe"> Waffenlagerung / Munitionsraum
            </label>
            <label style="display:flex; align-items:center; gap:8px; font-size:0.85rem; cursor:pointer;">
              <input type="checkbox" id="srvKraftwerk"> Notstromversorgung
            </label>
            <label style="display:flex; align-items:center; gap:8px; font-size:0.85rem; cursor:pointer;">
              <input type="checkbox" id="srvFreizeit"> Freizeiteinrichtung
            </label>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>

  <div id="formStep4" style="display:none">
  <div class="card">
    <div class="card-header">
      <div class="card-title">Transport & Fahrzeuge</div>
      <button class="btn btn-ghost btn-sm" onclick="addFahrzeugRow()">+ Fahrzeug hinzufÃ¼gen</button>
    </div>

```
<!-- Fahrzeug-Tabelle: Kennzeichen + Typ korrespondieren -->
<div class="mb16">
  <div class="table-wrap">
    <table id="fahrzeugTable">
      <thead>
        <tr>
          <th>Kategorie</th>
          <th>Kennzeichen</th>
          <th>Typ / Modell</th>
          <th>Zuladung</th>
          <th>AnhÃ¤nger</th>
          <th>AbstellflÃ¤che (mÂ²)</th>
          <th>ADR</th>
          <th>Aktion</th>
        </tr>
      </thead>
      <tbody id="fahrzeugTableBody">
        <tr>
          <td><select class="form-control fz-kat-select" style="min-width:130px" onchange="updateFahrzeugTyp(this)">
            <option value="lkw">ğŸš› LKW</option>
            <option value="pkw">ğŸš— PKW</option>
            <option value="bus">ğŸšŒ Bus</option>
            <option value="container">ğŸ“¦ Container</option>
            <option value="transporter">ğŸš Transporter</option>
          </select></td>
          <td><input class="form-control" placeholder="B-AB 1234" style="min-width:110px"></td>
          <td><select class="form-control fz-typ-select" style="min-width:175px" onchange="autoFlaeche(this)">
            <option value="Standard-LKW (7,5t)" data-flaeche="42" data-zuladung="7,5t">Standard-LKW (7,5t)</option>
            <option value="LKW 15t" data-flaeche="50" data-zuladung="15t">LKW 15t</option>
            <option value="Schwerlast-LKW (40t)" data-flaeche="56" data-zuladung="40t">Schwerlast-LKW (40t)</option>
            <option value="KÃ¼hlfahrzeug" data-flaeche="45" data-zuladung="variabel">KÃ¼hlfahrzeug</option>
            <option value="Tankfahrzeug" data-flaeche="48" data-zuladung="variabel">Tankfahrzeug</option>
            <option value="Sattelzug" data-flaeche="70" data-zuladung="25t">Sattelzug</option>
          </select></td>
          <td><input class="form-control fz-zuladung" placeholder="auto" style="min-width:90px" readonly style="color:var(--amber)"></td>
          <td><select class="form-control fz-anhaenger" style="min-width:140px" onchange="autoFlaeche(this.closest('tr').querySelector('.fz-typ-select'))">
            <option value="0">â€” Kein AnhÃ¤nger</option>
            <option value="20">EinachsanhÃ¤nger (+20mÂ²)</option>
            <option value="30">TandemanhÃ¤nger (+30mÂ²)</option>
            <option value="40">Sattelauflieger (+40mÂ²)</option>
            <option value="14">ContaineranhÃ¤nger 20ft (+14mÂ²)</option>
            <option value="28">ContaineranhÃ¤nger 40ft (+28mÂ²)</option>
          </select></td>
          <td><input class="form-control fz-flaeche" type="number" placeholder="auto" style="min-width:80px;color:var(--amber)" oninput="updateGesamtflaeche()"></td>
          <td><select class="form-control" style="min-width:120px">
            <option>Kein ADR</option>
            <option>ADR Klasse 1</option>
            <option>ADR Klasse 2</option>
            <option>ADR Klasse 3</option>
            <option>ADR Klasse 7</option>
          </select></td>
          <td><button class="btn btn-danger btn-sm" onclick="this.closest('tr').remove(); updateGesamtflaeche()">âœ•</button></td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="flex items-center gap12 mt12" style="padding:10px; background:var(--bg3); border-radius:var(--radius); border:1px solid var(--border);">
    <span class="text-sm text-muted">Gesamte AbstellflÃ¤che:</span>
    <span class="font-mono text-amber fw7" id="gesamtFlaeche">0 mÂ²</span>
    <span class="text-sm text-muted" style="margin-left:auto">Fahrzeuge gesamt:</span>
    <span class="font-mono text-amber fw7" id="fahrzeugCount">1</span>
  </div>
</div>

<hr class="separator">
<div class="grid-2">
  <div class="form-group">
    <label class="form-label">Transfer-Typ</label>
    <select class="form-control" id="tTransfer">
      <option>Eigentransport</option>
      <option>Charterprovider</option>
      <option>Linienflug + Bodentransport</option>
      <option>Seeweg + Bodentransport</option>
      <option>Bahn + Bodentransport</option>
    </select>
  </div>
  <div class="form-group">
    <label class="form-label">Container (Anzahl zusÃ¤tzlich)</label>
    <input type="number" class="form-control" id="tContainer" value="0" min="0">
  </div>
</div>
```

  </div>
  </div>

  <div id="formStep5" style="display:none">
  <div class="card">
    <div class="card-header"><div class="card-title">Zusammenfassung & Freigabe</div></div>
    <div id="summaryContent" class="font-mono text-sm" style="white-space:pre-line; color:var(--text2); line-height:1.8;">
      Bitte alle vorherigen Schritte ausfÃ¼llen...
    </div>
    <hr class="separator">
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Unterschrift Anforderer</label>
        <input class="form-control" placeholder="Digitale BestÃ¤tigung: Name eingeben">
      </div>
      <div class="form-group">
        <label class="form-label">Freigabe durch (Vorgesetzter)</label>
        <input class="form-control" placeholder="Name Vorgesetzter">
      </div>
    </div>
    <div class="alert alert-amber mt12">ğŸ“‹ Diese Anforderung wird nach Einreichung automatisch an die OPS360-Zentrale sowie die zustÃ¤ndige BehÃ¶rde weitergeleitet.</div>
  </div>
  </div>

  <!-- Form Navigation -->

  <div class="flex justify-between mt16 no-print">
    <button class="btn btn-ghost" id="prevStepBtn" onclick="prevStep()" style="visibility:hidden">â—€ ZurÃ¼ck</button>
    <div class="text-muted text-sm" id="stepLabel">Schritt 1 von 5</div>
    <button class="btn btn-primary" id="nextStepBtn" onclick="nextStep()">Weiter â–¶</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PHASE 1 â€” TRANSIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div class="view" id="view-phase1">
  <div class="page-header">
    <div>
      <div class="page-title">Phase 1 â€” <span>Transit</span></div>
      <div class="page-sub">Personal- & Materialtransit Â· Hin- und RÃ¼ckverlegung</div>
    </div>
    <button class="btn btn-primary" onclick="openModal('newTransitModal')">+ Neuer Transit</button>
  </div>
  <div class="grid-4 mb16">
    <div class="kpi-card amber">
      <div class="kpi-label">Aktive Transits</div>
      <div class="kpi-value">7</div>
      <div class="kpi-sub">3 Hinverlegung Â· 4 RÃ¼ckverlegung</div>
    </div>
    <div class="kpi-card blue">
      <div class="kpi-label">Personal im Transit</div>
      <div class="kpi-value">128</div>
      <div class="kpi-sub">in Bewegung</div>
    </div>
    <div class="kpi-card green">
      <div class="kpi-label">Fahrzeuge im Transit</div>
      <div class="kpi-value">34</div>
      <div class="kpi-sub">LKW + PKW</div>
    </div>
    <div class="kpi-card red">
      <div class="kpi-label">VerzÃ¶gerungen</div>
      <div class="kpi-value">2</div>
      <div class="kpi-sub">Grenzabfertigung ausstehend</div>
    </div>
  </div>
  <div class="card">
    <div class="card-header">
      <div class="card-title">Transit-Ãœbersicht</div>
      <div class="flex gap8">
        <select class="form-control" style="width:auto; padding:5px 10px; font-size:0.8rem;">
          <option>Alle Richtungen</option>
          <option>Hinverlegung</option>
          <option>RÃ¼ckverlegung</option>
        </select>
      </div>
    </div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Transit-ID</th>
            <th>Von â†’ Nach</th>
            <th>Typ</th>
            <th>Personal</th>
            <th>Material / Fahrzeuge</th>
            <th>Abfahrt</th>
            <th>ETA</th>
            <th>GrenzÃ¼bergang</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="transitTable">
          <!-- filled by JS -->
        </tbody>
      </table>
    </div>
  </div>
  <div class="grid-2 mt16">
    <div class="card">
      <div class="card-header"><div class="card-title">Checkliste â€” Hinverlegung</div></div>
      <div id="checklistHin"></div>
    </div>
    <div class="card">
      <div class="card-header"><div class="card-title">Checkliste â€” RÃ¼ckverlegung</div></div>
      <div id="checklistRueck"></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PHASE 2 â€” FINAL LOCATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div class="view" id="view-phase2">
  <div class="page-header">
    <div>
      <div class="page-title">Phase 2 â€” <span>Final Location</span></div>
      <div class="page-sub">UnterstÃ¼tzung am Einsatzort Â· Vollservice</div>
    </div>
    <button class="btn btn-primary" onclick="openModal('newLocationModal')">+ Standort hinzufÃ¼gen</button>
  </div>
  <div class="grid-3 mb16" id="locationCards">
    <!-- filled by JS -->
  </div>
  <div class="card">
    <div class="card-header"><div class="card-title">Service-Status aller Standorte</div></div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Standort</th>
            <th>Land</th>
            <th>Personal</th>
            <th>Unterkunft</th>
            <th>Verpflegung</th>
            <th>WÃ¤sche</th>
            <th>SanitÃ¤r</th>
            <th>IT</th>
            <th>Abfall</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="locationTable">
          <!-- filled by JS -->
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SERVICES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div class="view" id="view-services">
  <div class="page-header">
    <div>
      <div class="page-title">Service<span>Ã¼bersicht</span></div>
      <div class="page-sub">Alle aktiven Dienstleistungen Â· Global</div>
    </div>
  </div>
  <div class="grid-4 mb16" id="serviceCards">
    <!-- filled by JS -->
  </div>
  <div class="grid-2">
    <div class="card">
      <div class="card-header"><div class="card-title">SLA-Status</div></div>
      <div id="slaTable"></div>
    </div>
    <div class="card">
      <div class="card-header"><div class="card-title">Anbieter / Dienstleister</div></div>
      <div id="providerTable"></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PERSONAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div class="view" id="view-personal">
  <div class="page-header">
    <div>
      <div class="page-title">Personal<span>verwaltung</span></div>
      <div class="page-sub">20 bis 5.000 Mitarbeiter Â· Globale KapazitÃ¤t</div>
    </div>
    <button class="btn btn-primary" onclick="openModal('importPersonalModal')">ğŸ“¥ Import / Masseneintrag</button>
  </div>
  <div class="grid-4 mb16">
    <div class="kpi-card amber">
      <div class="kpi-label">Gesamt im Einsatz</div>
      <div class="kpi-value">347</div>
    </div>
    <div class="kpi-card green">
      <div class="kpi-label">Untergebracht</div>
      <div class="kpi-value">302</div>
    </div>
    <div class="kpi-card blue">
      <div class="kpi-label">Im Transit</div>
      <div class="kpi-value">28</div>
    </div>
    <div class="kpi-card red">
      <div class="kpi-label">Ausstehend</div>
      <div class="kpi-value">17</div>
    </div>
  </div>
  <div class="card">
    <div class="card-header">
      <div class="card-title">Mitarbeiterliste</div>
      <input class="form-control" style="width:220px" placeholder="ğŸ” Suchen..." oninput="filterPersonal(this.value)">
    </div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Abteilung</th>
            <th>Standort</th>
            <th>Phase</th>
            <th>Unterkunft</th>
            <th>Status</th>
            <th>Check-in</th>
            <th>Check-out</th>
          </tr>
        </thead>
        <tbody id="personalTable">
          <!-- filled by JS -->
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TRANSPORT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div class="view" id="view-transport">
  <div class="page-header">
    <div>
      <div class="page-title">Transport &amp; <span>FlÃ¤chen</span></div>
      <div class="page-sub">LKW Â· Container Â· PKW Â· AbstellflÃ¤chen</div>
    </div>
  </div>
  <div class="grid-4 mb16">
    <div class="kpi-card amber">
      <div class="kpi-label">LKW (aktiv)</div>
      <div class="kpi-value">23</div>
      <div class="kpi-sub">Geplant: +8</div>
    </div>
    <div class="kpi-card blue">
      <div class="kpi-label">Container (gesamt)</div>
      <div class="kpi-value">47</div>
      <div class="kpi-sub">12 BÃ¼ro Â· 35 Standard</div>
    </div>
    <div class="kpi-card green">
      <div class="kpi-label">PKW / Busse</div>
      <div class="kpi-value">61</div>
      <div class="kpi-sub">inkl. 4 Minibus</div>
    </div>
    <div class="kpi-card red">
      <div class="kpi-label">AbstellflÃ¤che (mÂ²)</div>
      <div class="kpi-value">8.420</div>
      <div class="kpi-sub">78% belegt</div>
    </div>
  </div>
  <div class="card">
    <div class="card-header"><div class="card-title">Fahrzeug- & Container-Ãœbersicht</div></div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Kennzeichen / ID</th>
            <th>Typ</th>
            <th>Standort</th>
            <th>Einsatz</th>
            <th>AbstellflÃ¤che (mÂ²)</th>
            <th>Ladung</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="transportTable">
          <!-- filled by JS -->
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ABRECHNUNG
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div class="view" id="view-abrechnung">
  <div class="page-header">
    <div>
      <div class="page-title">Ab<span>rechnung</span></div>
      <div class="page-sub">Rechnungsstellung Â· BehÃ¶rden Â· Kostenstellen</div>
    </div>
    <div class="flex gap8">
      <button class="btn btn-ghost btn-sm" onclick="openModal('exportModal')">ğŸ“Š Export</button>
      <button class="btn btn-primary" onclick="openModal('newRechnungModal')">+ Rechnung erstellen</button>
    </div>
  </div>
  <div class="grid-4 mb16">
    <div class="kpi-card amber">
      <div class="kpi-label">Offen (gesamt)</div>
      <div class="kpi-value">â‚¬ 2,4M</div>
      <div class="kpi-sub">8 ausstehende Rechnungen</div>
    </div>
    <div class="kpi-card green">
      <div class="kpi-label">Bezahlt (Monat)</div>
      <div class="kpi-value">â‚¬ 1,1M</div>
      <div class="kpi-sub">5 beglichen</div>
    </div>
    <div class="kpi-card blue">
      <div class="kpi-label">Budget (gesamt)</div>
      <div class="kpi-value">â‚¬ 8,5M</div>
      <div class="kpi-sub">Auslastung 42%</div>
    </div>
    <div class="kpi-card red">
      <div class="kpi-label">ÃœberfÃ¤llig</div>
      <div class="kpi-value">â‚¬ 340K</div>
      <div class="kpi-sub">2 Rechnungen > 30 Tage</div>
    </div>
  </div>
  <div class="card">
    <div class="card-header"><div class="card-title">RechnungsÃ¼bersicht</div></div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Rechnungs-Nr.</th>
            <th>EmpfÃ¤nger / BehÃ¶rde</th>
            <th>Einsatz</th>
            <th>Leistungszeitraum</th>
            <th>Betrag (EUR)</th>
            <th>FÃ¤llig am</th>
            <th>Status</th>
            <th>Aktionen</th>
          </tr>
        </thead>
        <tbody id="rechnungTable">
          <!-- filled by JS -->
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PARTNER / BEHÃ–RDEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div class="view" id="view-partner">
  <div class="page-header">
    <div>
      <div class="page-title">BehÃ¶rden &amp; <span>Partner</span></div>
      <div class="page-sub">Staatliche Stellen Â· Dienstleister Â· Koordination</div>
    </div>
    <button class="btn btn-primary" onclick="openModal('newPartnerModal')">+ Partner hinzufÃ¼gen</button>
  </div>
  <div class="card">
    <div class="card-header"><div class="card-title">Partnerdatenbank</div></div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Land</th>
            <th>Typ</th>
            <th>Ansprechpartner</th>
            <th>Telefon</th>
            <th>E-Mail</th>
            <th>Aktive EinsÃ¤tze</th>
            <th>Vereinbarung bis</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="partnerTable">
          <!-- filled by JS -->
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     VORLAGEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div class="view" id="view-vorlagen">
  <div class="page-header">
    <div>
      <div class="page-title">Vorlagen &amp; <span>Dokumente</span></div>
      <div class="page-sub">Standarddokumente Â· Formulare Â· Checklisten</div>
    </div>
  </div>
  <div class="grid-3" id="vorlagenGrid">
    <!-- filled by JS -->
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ABTEILUNGEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div class="view" id="view-abteilungen">
  <div class="page-header">
    <div>
      <div class="page-title">Ab<span>teilungen</span></div>
      <div class="page-sub">5 eigenstÃ¤ndige Einheiten Â· BedarfsÃ¼bermittlung</div>
    </div>
  </div>
  <div class="grid-3" id="abteilungCards">
    <!-- filled by JS -->
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     KARTE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div class="view" id="view-karte">
  <div class="page-header">
    <div>
      <div class="page-title">Welt<span>karte</span></div>
      <div class="page-sub">360Â° â€” Globale EinsatzÃ¼bersicht</div>
    </div>
  </div>
  <div class="card">
    <div class="world-map" id="worldMap">
      <div style="text-align:center; color:var(--text3);">
        <div style="font-size:3rem; margin-bottom:8px;">ğŸŒ</div>
        <div class="font-cond" style="font-size:1.2rem; letter-spacing:2px;">INTERAKTIVE KARTE</div>
        <div class="text-sm mt8">FÃ¼r die Produktionsversion: OpenStreetMap / Mapbox API integrieren</div>
      </div>
      <!-- Static location dots -->
      <div class="map-dot" style="left:49%; top:38%;"></div>
      <div style="position:absolute;left:49%;top:42%" class="map-label">DE â€” Berlin</div>
      <div class="map-dot" style="left:47%; top:40%; background:var(--green); box-shadow:0 0 12px var(--green);"></div>
      <div class="map-dot" style="left:52%; top:37%; background:var(--blue); box-shadow:0 0 12px var(--blue);"></div>
      <div class="map-dot" style="left:51%; top:42%; background:var(--amber);"></div>
      <div class="map-dot" style="left:24%; top:42%; background:var(--cyan); box-shadow:0 0 12px var(--cyan);"></div>
    </div>
  </div>
  <div class="grid-3 mt16" id="mapLegend">
    <div class="card">
      <div class="card-title mb8">ğŸŸ¡ Amber â€” Transit aktiv (Phase 1)</div>
      <div class="text-sm text-muted">3 Standorte mit laufenden Transporten</div>
    </div>
    <div class="card">
      <div class="card-title mb8">ğŸŸ¢ GrÃ¼n â€” Final Location (Phase 2)</div>
      <div class="text-sm text-muted">5 Standorte in Vollbetrieb</div>
    </div>
    <div class="card">
      <div class="card-title mb8">ğŸ”µ Blau â€” Geplant (30-Tage-Vorlauf)</div>
      <div class="text-sm text-muted">4 EinsÃ¤tze in Planung</div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     KALENDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div class="view" id="view-kalender">
  <div class="page-header">
    <div>
      <div class="page-title">Einsatz<span>kalender</span></div>
      <div class="page-sub">30-Tage-Planung Â· Alle Abteilungen</div>
    </div>
  </div>
  <div class="card mb16">
    <div class="card-header">
      <div class="card-title">NÃ¤chste 30 Tage</div>
      <div class="flex gap8">
        <button class="btn btn-ghost btn-sm">â—€</button>
        <button class="btn btn-ghost btn-sm">â–¶</button>
      </div>
    </div>
    <div class="cal-strip" id="calStrip"></div>
  </div>
  <div class="card">
    <div class="card-header"><div class="card-title">Geplante Ereignisse</div></div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Datum</th>
            <th>Ereignis</th>
            <th>Abteilung</th>
            <th>Land</th>
            <th>Personal</th>
            <th>Typ</th>
          </tr>
        </thead>
        <tbody id="kalenderTable">
          <!-- filled by JS -->
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     EINSTELLUNGEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div class="view" id="view-einstellungen">
  <div class="page-header">
    <div><div class="page-title">Ein<span>stellungen</span></div></div>
  </div>
  <div class="grid-2">
    <div class="card">
      <div class="card-header"><div class="card-title">Organisation</div></div>
      <div class="form-group">
        <label class="form-label">Unternehmensname</label>
        <input class="form-control" value="Musterfirma AG" id="settCompany">
      </div>
      <div class="form-group">
        <label class="form-label">OPS-Leiter</label>
        <input class="form-control" id="settOpsLeiter" placeholder="Name des OPS-Leiters">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Vorlauf-Standard (Tage)</label>
          <input class="form-control" type="number" value="30" id="settVorlauf">
        </div>
        <div class="form-group">
          <label class="form-label">StandardwÃ¤hrung</label>
          <select class="form-control" id="settWaehrung">
            <option>EUR</option><option>USD</option><option>GBP</option>
          </select>
        </div>
      </div>
      <button class="btn btn-primary mt8" onclick="showToast('âœ… Einstellungen gespeichert','green')">Speichern</button>
    </div>
    <div class="card">
      <div class="card-header"><div class="card-title">Abteilungen konfigurieren</div></div>
      <div id="deptConfig"></div>
    </div>
  </div>
</div>

</div><!-- /main -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MODALS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<!-- ALERT MODAL -->

<div class="modal-overlay" id="alertModal">
  <div class="modal" style="max-width:500px">
    <div class="modal-header">
      <div class="modal-title">ğŸ”” Aktuelle Meldungen</div>
      <button class="modal-close" onclick="closeModal('alertModal')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="alert alert-red">ğŸš¨ <strong>GrenzÃ¼bergang Kehl (DEâ†’FR)</strong> â€” VerzÃ¶gerung 4h. Transit TRN-007 betroffen.</div>
      <div class="alert alert-amber">âš ï¸ <strong>ABT-3 Anforderung fehlt</strong> â€” Vorlauf unterschritten. 28 Tage verbleibend.</div>
      <div class="alert alert-green">âœ… <strong>Rechnung RG-2024-041</strong> â€” Zahlung durch BehÃ¶rde Frankreich bestÃ¤tigt.</div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('alertModal')">SchlieÃŸen</button>
      <button class="btn btn-primary">Alle bestÃ¤tigen</button>
    </div>
  </div>
</div>

<!-- EXPORT MODAL -->

<div class="modal-overlay" id="exportModal">
  <div class="modal" style="max-width:460px">
    <div class="modal-header">
      <div class="modal-title">ğŸ“¤ Export</div>
      <button class="modal-close" onclick="closeModal('exportModal')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">Exportformat</label>
        <select class="form-control">
          <option>Excel (.xlsx)</option>
          <option>CSV</option>
          <option>PDF-Bericht</option>
          <option>Word-Dokument (.docx)</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Zeitraum</label>
        <div class="form-row">
          <input type="date" class="form-control">
          <input type="date" class="form-control">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Inhalte</label>
        <div style="display:flex; flex-direction:column; gap:6px; margin-top:4px;">
          <label style="display:flex;align-items:center;gap:8px;font-size:0.85rem"><input type="checkbox" checked> Bedarfsanforderungen</label>
          <label style="display:flex;align-items:center;gap:8px;font-size:0.85rem"><input type="checkbox" checked> Personal</label>
          <label style="display:flex;align-items:center;gap:8px;font-size:0.85rem"><input type="checkbox" checked> Abrechnung</label>
          <label style="display:flex;align-items:center;gap:8px;font-size:0.85rem"><input type="checkbox"> Transit-Details</label>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('exportModal')">Abbrechen</button>
      <button class="btn btn-primary" onclick="showToast('ğŸ“¥ Export wird erstellt...','amber'); closeModal('exportModal')">Export starten</button>
    </div>
  </div>
</div>

<!-- NEW TRANSIT MODAL -->

<div class="modal-overlay" id="newTransitModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">+ Neuer Transit (Phase 1)</div>
      <button class="modal-close" onclick="closeModal('newTransitModal')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group"><label class="form-label">Von (Start)</label><input class="form-control" placeholder="Land / Ort"></div>
        <div class="form-group"><label class="form-label">Nach (Ziel)</label><input class="form-control" placeholder="Land / Ort"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Richtung</label>
          <select class="form-control"><option>Hinverlegung</option><option>RÃ¼ckverlegung</option></select>
        </div>
        <div class="form-group"><label class="form-label">Abteilung</label>
          <select class="form-control">
            <option>ABT-1: Planung</option><option>ABT-2: Logistik</option><option>ABT-3: Technik</option>
            <option>ABT-4: Infrastruktur</option><option>ABT-5: Support</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Abfahrtsdatum</label><input type="date" class="form-control"></div>
        <div class="form-group"><label class="form-label">ETA (Ankunft)</label><input type="date" class="form-control"></div>
      </div>
      <div class="form-row-3">
        <div class="form-group"><label class="form-label">Personen</label><input type="number" class="form-control" value="0"></div>
        <div class="form-group"><label class="form-label">LKW</label><input type="number" class="form-control" value="0"></div>
        <div class="form-group"><label class="form-label">PKW</label><input type="number" class="form-control" value="0"></div>
      </div>
      <div class="form-group"><label class="form-label">GrenzÃ¼bergangspunkt</label><input class="form-control" placeholder="Name/Lage des GrenzÃ¼bergangs"></div>
      <div class="form-group"><label class="form-label">BehÃ¶rde (Zielland)</label><input class="form-control" placeholder="Staatliche Stelle"></div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('newTransitModal')">Abbrechen</button>
      <button class="btn btn-primary" onclick="saveTransit()">Transit anlegen</button>
    </div>
  </div>
</div>

<!-- NEW RECHNUNG MODAL -->

<div class="modal-overlay" id="newRechnungModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">+ Neue Rechnung</div>
      <button class="modal-close" onclick="closeModal('newRechnungModal')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group"><label class="form-label">EmpfÃ¤nger / BehÃ¶rde</label><input class="form-control" placeholder="Name der BehÃ¶rde"></div>
        <div class="form-group"><label class="form-label">Bezug / Einsatz-ID</label><input class="form-control" placeholder="EIN-XXX"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Leistungszeitraum Von</label><input type="date" class="form-control"></div>
        <div class="form-group"><label class="form-label">Leistungszeitraum Bis</label><input type="date" class="form-control"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Rechnungsbetrag (EUR netto)</label><input type="number" class="form-control" placeholder="0,00"></div>
        <div class="form-group"><label class="form-label">MwSt. %</label><select class="form-control"><option>0%</option><option>7%</option><option selected>19%</option></select></div>
      </div>
      <div class="form-group"><label class="form-label">Leistungsbeschreibung</label><textarea class="form-control" rows="3" placeholder="Unterkunft, Verpflegung, Transport..."></textarea></div>
      <div class="form-group"><label class="form-label">Zahlungsziel (Tage)</label><input type="number" class="form-control" value="30"></div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('newRechnungModal')">Abbrechen</button>
      <button class="btn btn-primary" onclick="saveRechnung()">Rechnung erstellen</button>
    </div>
  </div>
</div>

<!-- IMPORT PERSONAL MODAL -->

<div class="modal-overlay" id="importPersonalModal">
  <div class="modal" style="max-width:500px">
    <div class="modal-header">
      <div class="modal-title">ğŸ“¥ Personal importieren</div>
      <button class="modal-close" onclick="closeModal('importPersonalModal')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="alert alert-amber">Massenimport Ã¼ber CSV oder Excel. Vorlage unten herunterladen.</div>
      <div class="form-group"><label class="form-label">Datei auswÃ¤hlen</label>
        <input type="file" class="form-control" accept=".csv,.xlsx">
      </div>
      <div class="form-group"><label class="form-label">Ziel-Abteilung</label>
        <select class="form-control"><option>Alle / Gemischt</option><option>ABT-1</option><option>ABT-2</option><option>ABT-3</option><option>ABT-4</option><option>ABT-5</option></select>
      </div>
      <button class="btn btn-ghost btn-sm" onclick="showToast('ğŸ“¥ Vorlage wird heruntergeladen...','blue')">â¬‡ï¸ Import-Vorlage herunterladen</button>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('importPersonalModal')">Abbrechen</button>
      <button class="btn btn-primary" onclick="showToast('âœ… Import erfolgreich','green'); closeModal('importPersonalModal')">Importieren</button>
    </div>
  </div>
</div>

<!-- TIME ADJUST MODAL -->

<div class="modal-overlay" id="timeModal">
  <div class="modal" style="max-width:400px">
    <div class="modal-header">
      <div class="modal-title">â±ï¸ Zeit anpassen</div>
      <button class="modal-close" onclick="closeModal('timeModal')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="alert alert-amber" style="margin-bottom:16px;">Manuelle Zeitanpassung â€” z.B. fÃ¼r andere Zeitzonen oder simulierte Zeitpunkte.</div>
      <div class="form-group">
        <label class="form-label">Modus</label>
        <div style="display:flex;gap:10px;margin-top:4px;">
          <label style="display:flex;align-items:center;gap:6px;font-size:0.85rem;cursor:pointer;">
            <input type="radio" name="timeModus" value="auto" id="modeAuto" checked onchange="toggleTimeMode()"> Automatisch (Systemzeit)
          </label>
          <label style="display:flex;align-items:center;gap:6px;font-size:0.85rem;cursor:pointer;">
            <input type="radio" name="timeModus" value="manual" id="modeManual" onchange="toggleTimeMode()"> Manuell
          </label>
        </div>
      </div>
      <div id="manualTimeFields" style="display:none;">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Datum</label>
            <input type="date" class="form-control" id="manualDate">
          </div>
          <div class="form-group">
            <label class="form-label">Uhrzeit (UTC)</label>
            <input type="time" class="form-control" id="manualTime" step="1">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Zeitzone</label>
          <select class="form-control" id="manualTZ">
            <option value="0">UTC+0 (London)</option>
            <option value="1" selected>UTC+1 (Berlin, Paris, Rom)</option>
            <option value="2">UTC+2 (Helsinki, Kiew)</option>
            <option value="3">UTC+3 (Moskau, Istanbul)</option>
            <option value="-5">UTC-5 (New York)</option>
            <option value="-6">UTC-6 (Chicago)</option>
            <option value="-8">UTC-8 (Los Angeles)</option>
            <option value="4">UTC+4 (Dubai)</option>
            <option value="5.5">UTC+5:30 (Indien)</option>
            <option value="8">UTC+8 (Singapur, China)</option>
            <option value="9">UTC+9 (Tokio)</option>
            <option value="10">UTC+10 (Sydney)</option>
          </select>
        </div>
        <div style="padding:10px;background:var(--bg3);border-radius:var(--radius);border:1px solid var(--border);text-align:center;">
          <div class="text-xs text-muted mb8">Vorschau</div>
          <div class="font-mono text-amber" id="timePreview" style="font-size:1.2rem;">--:--:--</div>
          <div class="text-xs text-muted" id="datePreview" style="margin-top:4px;">--</div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="resetTime()">â†º ZurÃ¼cksetzen</button>
      <button class="btn btn-ghost" onclick="closeModal('timeModal')">Abbrechen</button>
      <button class="btn btn-primary" onclick="applyTime()">âœ… Ãœbernehmen</button>
    </div>
  </div>
</div>

<!-- SAVE / FALLBACK MODAL -->

<div class="modal-overlay" id="saveModal">
  <div class="modal" style="max-width:560px">
    <div class="modal-header">
      <div class="modal-title">ğŸ’¾ App speichern â€” iOS</div>
      <button class="modal-close" onclick="closeModal('saveModal')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="alert alert-amber" style="margin-bottom:16px;">
        â„¹ï¸ <strong>So speicherst du die App auf dem iPad:</strong>
      </div>

```
  <!-- Methode 1 -->
  <div style="background:var(--bg3);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:12px;">
    <div class="font-cond fw7" style="font-size:1rem;margin-bottom:8px;color:var(--amber);">Methode 1 â€” Empfohlen</div>
    <div class="text-sm" style="line-height:1.8;">
      1. Tippe auf <strong>â€Neuen Tab Ã¶ffnen"</strong> unten<br>
      2. Im neuen Tab: Tippe auf das <strong>Teilen-Symbol â†‘</strong> oben in Safari<br>
      3. WÃ¤hle <strong>â€In Dateien sichern"</strong><br>
      4. Speicherort wÃ¤hlen â†’ <strong>Sichern</strong>
    </div>
    <button class="btn btn-primary mt12" onclick="openInNewTab()">ğŸ”— Neuen Tab Ã¶ffnen</button>
  </div>

  <!-- Methode 2 -->
  <div style="background:var(--bg3);border:1px solid var(--border);border-radius:var(--radius);padding:16px;">
    <div class="font-cond fw7" style="font-size:1rem;margin-bottom:8px;color:var(--text2);">Methode 2 â€” Code kopieren</div>
    <div class="text-sm text-muted" style="margin-bottom:10px;">Kompletten Code kopieren â†’ In Texteditor (z.B. Notizen) einfÃ¼gen â†’ Als .html speichern</div>
    <textarea id="saveContent" class="form-control" rows="4" readonly style="font-size:0.65rem;font-family:monospace;resize:none;"></textarea>
    <button class="btn btn-outline mt8" onclick="copySaveContent()">ğŸ“‹ Code kopieren</button>
  </div>
</div>
<div class="modal-footer">
  <button class="btn btn-ghost" onclick="closeModal('saveModal')">SchlieÃŸen</button>
</div>
```

  </div>
</div>

<!-- TOAST CONTAINER -->

<div class="toast-container" id="toasts"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const depts = [
  { id:'ABT-1', name:'Planung', color:'amber', requests:4, lead:'Maj. Klein' },
  { id:'ABT-2', name:'Logistik', color:'blue', requests:3, lead:'Hptm. Weber' },
  { id:'ABT-3', name:'Technik', color:'green', requests:5, lead:'OFw. Fischer' },
  { id:'ABT-4', name:'Infrastruktur', color:'red', requests:2, lead:'OF. MÃ¼ller' },
  { id:'ABT-5', name:'Support', color:'amber', requests:1, lead:'Fw. Bauer' },
];

const einsaetze = [
  { id:'EIN-001', land:'ğŸ‡©ğŸ‡ª Deutschland', standort:'Berlin-Tegel', phase:1, pers:45, fahrzeuge:'8 LKW / 12 PKW', status:'transit', statusLabel:'Im Transit' },
  { id:'EIN-002', land:'ğŸ‡«ğŸ‡· Frankreich', standort:'Lyon-Est', phase:2, pers:180, fahrzeuge:'15 LKW / 22 PKW', status:'aktiv', statusLabel:'Aktiv' },
  { id:'EIN-003', land:'ğŸ‡µğŸ‡± Polen', standort:'Warschau-SÃ¼d', phase:2, pers:120, fahrzeuge:'10 LKW / 18 PKW', status:'aktiv', statusLabel:'Aktiv' },
  { id:'EIN-004', land:'ğŸ‡³ğŸ‡± Niederlande', standort:'Rotterdam', phase:1, pers:22, fahrzeuge:'4 LKW / 5 PKW', status:'geplant', statusLabel:'Geplant' },
  { id:'EIN-005', land:'ğŸ‡§ğŸ‡ª Belgien', standort:'BrÃ¼ssel', phase:2, pers:65, fahrzeuge:'6 LKW / 9 PKW', status:'aktiv', statusLabel:'Aktiv' },
];

const transits = [
  { id:'TRN-001', von:'Berlin', nach:'Paris', typ:'Hinverlegung', pers:28, material:'4 LKW', abfahrt:'2026-03-01', eta:'2026-03-03', grenze:'Kehl', status:'aktiv' },
  { id:'TRN-002', von:'MÃ¼nchen', nach:'Wien', typ:'RÃ¼ckverlegung', pers:14, material:'2 LKW', abfahrt:'2026-03-02', eta:'2026-03-02', grenze:'Salzburg', status:'abgeschlossen' },
  { id:'TRN-003', von:'Hamburg', nach:'Warschau', typ:'Hinverlegung', pers:45, material:'8 LKW + 3 Container', abfahrt:'2026-03-05', eta:'2026-03-07', grenze:'Frankfurt/Oder', status:'geplant' },
  { id:'TRN-004', von:'KÃ¶ln', nach:'BrÃ¼ssel', typ:'Hinverlegung', pers:18, material:'2 LKW', abfahrt:'2026-02-28', eta:'2026-02-28', grenze:'Aachen', status:'verzÃ¶gert' },
];

const locations = [
  { id:'LOC-001', name:'Camp Lyon-Est', land:'ğŸ‡«ğŸ‡· FR', pers:180, unterkunft:'Hotel', verpf:'âœ…', waesche:'âœ…', sanitaer:'âœ…', it:'âœ…', abfall:'âœ…', status:'aktiv' },
  { id:'LOC-002', name:'Lager Warschau', land:'ğŸ‡µğŸ‡± PL', pers:120, unterkunft:'Container', verpf:'âœ…', waesche:'âš ï¸', sanitaer:'âœ…', it:'âœ…', abfall:'âœ…', status:'aktiv' },
  { id:'LOC-003', name:'Basis BrÃ¼ssel', land:'ğŸ‡§ğŸ‡ª BE', pers:65, unterkunft:'Hotel', verpf:'âœ…', waesche:'âœ…', sanitaer:'âœ…', it:'âœ…', abfall:'âš ï¸', status:'aktiv' },
];

const personal = [
  { id:'P-001', name:'MÃ¼ller, Hans', abt:'ABT-1', standort:'Lyon-Est', phase:2, unterkunft:'Hotel Ibis 204', status:'Aktiv', ein:'2026-02-15', aus:'2026-04-15' },
  { id:'P-002', name:'Schmidt, Anna', abt:'ABT-2', standort:'Warschau', phase:2, unterkunft:'Container C-12', status:'Aktiv', ein:'2026-02-20', aus:'2026-03-20' },
  { id:'P-003', name:'Fischer, Klaus', abt:'ABT-3', standort:'Im Transit', phase:1, unterkunft:'TRN-001', status:'Transit', ein:'2026-03-01', aus:'2026-03-10' },
  { id:'P-004', name:'Weber, Maria', abt:'ABT-1', standort:'Berlin', phase:1, unterkunft:'Holiday Inn 301', status:'Aktiv', ein:'2026-02-25', aus:'2026-03-05' },
  { id:'P-005', name:'Bauer, Peter', abt:'ABT-5', standort:'BrÃ¼ssel', phase:2, unterkunft:'NH Hotel 112', status:'Aktiv', ein:'2026-02-18', aus:'2026-03-18' },
];

const transporte = [
  { id:'LKW-DE-001', typ:'LKW 40t', standort:'Lyon-Est', einsatz:'EIN-002', flaeche:56, ladung:'Material', status:'aktiv' },
  { id:'CNT-FR-012', typ:'Container 20ft', standort:'Warschau', einsatz:'EIN-003', flaeche:14, ladung:'BÃ¼ro', status:'aktiv' },
  { id:'PKW-DE-045', typ:'PKW SUV', standort:'Im Transit', einsatz:'TRN-001', flaeche:6, ladung:'Personen', status:'transit' },
  { id:'BUS-BE-003', typ:'Minibus 9-Sitz', standort:'BrÃ¼ssel', einsatz:'EIN-005', flaeche:12, ladung:'Personen', status:'aktiv' },
];

const rechnungen = [
  { nr:'RG-2026-001', empfaenger:'Ministerium Frankreich', einsatz:'EIN-002', zeitraum:'Feb 2026', betrag:'â‚¬ 320.000', faellig:'2026-03-28', status:'offen' },
  { nr:'RG-2026-002', empfaenger:'BehÃ¶rde Warschau', einsatz:'EIN-003', zeitraum:'Feb 2026', betrag:'â‚¬ 210.000', faellig:'2026-03-15', status:'bezahlt' },
  { nr:'RG-2026-003', empfaenger:'BehÃ¶rde BrÃ¼ssel', einsatz:'EIN-005', zeitraum:'Jan 2026', betrag:'â‚¬ 95.000', faellig:'2026-02-01', status:'Ã¼berfÃ¤llig' },
];

const partner = [
  { name:'MinistÃ¨re des ArmÃ©es', land:'ğŸ‡«ğŸ‡· FR', typ:'BehÃ¶rde', ap:'Col. Bernard Leclerc', tel:'+33 1 4205 xxxx', mail:'bernard.leclerc@defense.fr', einsaetze:2, bis:'2027-12-31', status:'aktiv' },
  { name:'MON Polska', land:'ğŸ‡µğŸ‡± PL', typ:'BehÃ¶rde', ap:'Gen. Andrzej Kowalski', tel:'+48 22 xxx xxxx', mail:'kowalski@mon.gov.pl', einsaetze:1, bis:'2026-06-30', status:'aktiv' },
  { name:'Sodexo GmbH', land:'ğŸ‡©ğŸ‡ª DE', typ:'Dienstleister', ap:'Stefan Voss', tel:'+49 30 xxxx xxxx', mail:'voss@sodexo.de', einsaetze:3, bis:'2026-12-31', status:'aktiv' },
  { name:'DHL Supply Chain', land:'ğŸ‡©ğŸ‡ª DE', typ:'Logistik', ap:'Petra Lang', tel:'+49 228 xxx', mail:'petra.lang@dhl.com', einsaetze:4, bis:'2027-03-31', status:'aktiv' },
];

const vorlagen = [
  { icon:'ğŸ“‹', name:'Bedarfsanforderung (Standard)', desc:'Alle 5 Abteilungen', type:'Formular', format:'PDF/DOCX' },
  { icon:'ğŸšš', name:'Transit-Checkliste Hinverlegung', desc:'Phase 1 â€” Ein- und Ausreise', type:'Checkliste', format:'PDF' },
  { icon:'ğŸ”™', name:'Transit-Checkliste RÃ¼ckverlegung', desc:'Phase 1 â€” RÃ¼ckreise', type:'Checkliste', format:'PDF' },
  { icon:'ğŸ•ï¸', name:'Standort-Einrichtungsprotokoll', desc:'Phase 2 â€” Final Location', type:'Protokoll', format:'PDF/DOCX' },
  { icon:'ğŸ¤', name:'BehÃ¶rden-Abstimmungsprotokoll', desc:'Staatliche Koordination', type:'Protokoll', format:'DOCX' },
  { icon:'ğŸ’°', name:'Abrechnungsvorlage', desc:'Rechnungsstellung an BehÃ¶rden', type:'Formular', format:'XLSX' },
  { icon:'ğŸ‘¥', name:'Personalliste (Masseneintrag)', desc:'Import-Vorlage CSV', type:'Import', format:'CSV/XLSX' },
  { icon:'ğŸš›', name:'Fahrzeug- & Containerliste', desc:'Transportplanung', type:'Formular', format:'XLSX' },
  { icon:'ğŸ›¡ï¸', name:'Sicherheitsunterweisung', desc:'Einsatz-Briefing Vorlage', type:'PrÃ¤sentation', format:'PPTX' },
  { icon:'ğŸ“Š', name:'Lagebericht Vorlage', desc:'WÃ¶chentlicher Statusbericht', type:'Bericht', format:'DOCX' },
  { icon:'âœ…', name:'Ãœbergabe-/Abnahmeprotokoll', desc:'Service-Abnahme am Standort', type:'Protokoll', format:'PDF' },
  { icon:'ğŸ“', name:'Kontakt- & Notrufkarte', desc:'Alle Ansprechpartner', type:'Karte', format:'PDF' },
];

const checlistHin = ['Marschbefehl erstellt', 'Passierscheine / Visa', 'GrenzÃ¼bertrittserlaubnis', 'Fahrzeugpapiere geprÃ¼ft', 'ADR-Dokumente (falls erforderlich)', 'Unterkunft am Zielort bestÃ¤tigt', 'Verpflegung unterwegs geregelt', 'Kommunikation geprÃ¼ft', 'Notfallkontakte informiert', 'Briefing durchgefÃ¼hrt'];
const checklistRueck = ['AusrÃ¼ckeliste erstellt', 'Ãœbergabeprotokoll unterzeichnet', 'Container-Inventar abgeschlossen', 'SchlÃ¼ssel/Zugangskarten zurÃ¼ckgegeben', 'Abfall vollstÃ¤ndig entsorgt', 'IT-AusrÃ¼stung erfasst', 'Rechnungen gestellt', 'Zolldokumente', 'Abschlussfotos gemacht', 'Einsatzbericht eingereicht'];

const activities = [
  { time:'Heute 09:14', title:'EIN-002 Lyon-Est', desc:'Verpflegungsvertrag verlÃ¤ngert +30 Tage', type:'green' },
  { time:'Heute 08:22', title:'TRN-004 verzÃ¶gert', desc:'GrenzÃ¼bergang Aachen â€” Wartezeit 4h', type:'amber' },
  { time:'Gestern 16:45', title:'ABT-3 Anforderung', desc:'Bedarfsanforderung BD-0047 eingegangen', type:'blue' },
  { time:'Gestern 14:10', title:'RG-2026-002 bezahlt', desc:'Zahlung Warschau â‚¬210.000 bestÃ¤tigt', type:'green' },
  { time:'27.02 09:00', title:'EIN-005 BrÃ¼ssel', desc:'Phase 2 Aufbau abgeschlossen', type:'blue' },
];

const dashAlerts = [
  { type:'amber', msg:'âš ï¸ ABT-3 Bedarfsanforderung fÃ¼r Einsatz EIN-008 â€” Vorlauf unterschritten (28 statt 30 Tage).' },
  { type:'red', msg:'ğŸš¨ TRN-004: GrenzÃ¼bergang Aachen verzÃ¶gert. Neue ETA: 19:00 Uhr. Unterkunft informieren.' },
  { type:'green', msg:'âœ… Phase-2-Aufbau LOC-003 (BrÃ¼ssel) erfolgreich abgeschlossen. Alle Services operationell.' },
];

const kalenderEvents = [
  { datum:'2026-03-01', name:'TRN-003 Abfahrt Hamburgâ†’Warschau', abt:'ABT-2', land:'ğŸ‡µğŸ‡± PL', pers:45, typ:'Transit' },
  { datum:'2026-03-05', name:'EIN-006 Aufbau Lyon Phase 2', abt:'ABT-4', land:'ğŸ‡«ğŸ‡· FR', pers:80, typ:'Phase 2' },
  { datum:'2026-03-08', name:'Abrechnung Frankreich fÃ¤llig', abt:'Zentrale', land:'ğŸ‡«ğŸ‡· FR', pers:0, typ:'Abrechnung' },
  { datum:'2026-03-12', name:'ABT-1 Anforderung Deadline', abt:'ABT-1', land:'ğŸ‡©ğŸ‡ª DE', pers:120, typ:'Anforderung' },
  { datum:'2026-03-15', name:'EIN-003 RÃ¼ckverlegung Begin', abt:'ABT-3', land:'ğŸ‡µğŸ‡± PL', pers:60, typ:'Transit' },
  { datum:'2026-03-20', name:'BehÃ¶rden-Meeting Warschau', abt:'Zentrale', land:'ğŸ‡µğŸ‡± PL', pers:0, typ:'Meeting' },
];

const slaData = [
  { service:'Unterkunft', sla:'99%', aktuell:'99.8%', ok:true },
  { service:'Verpflegung', sla:'98%', aktuell:'99.1%', ok:true },
  { service:'WÃ¤scheservice', sla:'95%', aktuell:'91.4%', ok:false },
  { service:'SanitÃ¤r', sla:'99%', aktuell:'99.5%', ok:true },
  { service:'IT/Internet', sla:'99%', aktuell:'97.2%', ok:false },
  { service:'Transport', sla:'95%', aktuell:'96.3%', ok:true },
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLOCK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â”€â”€ Time state â”€â”€
let _manualMode = false;
let _manualTimestamp = null; // fixed Date object
let _manualTZOffset = 1;     // hours offset for display

function _getDisplayTime() {
  if (_manualMode && _manualTimestamp) {
    // Advance manual time in real-time
    const elapsed = Date.now() - _manualTimestamp.set;
    return new Date(_manualTimestamp.base + elapsed);
  }
  return new Date();
}

function updateClock() {
  const now = _getDisplayTime();
  const tzOff = _manualMode ? _manualTZOffset : 0; // UTC for auto, chosen TZ for manual
  const display = new Date(now.getTime() + (now.getTimezoneOffset() * 60000) + (tzOff * 3600000));
  const h = String(display.getHours()).padStart(2,'0');
  const m = String(display.getMinutes()).padStart(2,'0');
  const s = String(display.getSeconds()).padStart(2,'0');
  const tzLabel = _manualMode ? (tzOff >= 0 ? 'UTC+'+tzOff : 'UTC'+tzOff) : 'UTC';
  document.getElementById('clock').textContent = h+':'+m+':'+s+' '+tzLabel;
  document.getElementById('dashDate').textContent = now.toLocaleDateString('de-DE', {weekday:'long',day:'numeric',month:'long',year:'numeric'});

  // Update preview in modal if open
  const prev = document.getElementById('timePreview');
  const dprev = document.getElementById('datePreview');
  if (prev && document.getElementById('timeModal').classList.contains('open')) {
    prev.textContent = h+':'+m+':'+s;
    if (dprev) dprev.textContent = now.toLocaleDateString('de-DE', {weekday:'long',day:'numeric',month:'long',year:'numeric'});
  }
}
setInterval(updateClock, 1000); updateClock();

function toggleTimeMode() {
  const manual = document.getElementById('modeManual').checked;
  document.getElementById('manualTimeFields').style.display = manual ? 'block' : 'none';
  if (manual) {
    // Pre-fill with current time
    const now = new Date();
    document.getElementById('manualDate').value = now.toISOString().substring(0,10);
    document.getElementById('manualTime').value = now.toTimeString().substring(0,8);
  }
}

function applyTime() {
  const manual = document.getElementById('modeManual').checked;
  if (!manual) {
    _manualMode = false;
    _manualTimestamp = null;
    showToast('ğŸ• ZurÃ¼ck zur Systemzeit', 'green');
    closeModal('timeModal');
    return;
  }
  const dateVal = document.getElementById('manualDate').value;
  const timeVal = document.getElementById('manualTime').value;
  const tz = parseFloat(document.getElementById('manualTZ').value);
  if (!dateVal || !timeVal) { showToast('âš ï¸ Bitte Datum und Uhrzeit eingeben', 'amber'); return; }
  const combined = new Date(dateVal + 'T' + timeVal);
  _manualMode = true;
  _manualTZOffset = tz;
  _manualTimestamp = { base: combined.getTime(), set: Date.now() };
  showToast('âœ… Zeit angepasst auf ' + timeVal + ' (UTC'+( tz>=0?'+':'')+tz+')', 'amber');
  closeModal('timeModal');
}

function resetTime() {
  _manualMode = false;
  _manualTimestamp = null;
  document.getElementById('modeAuto').checked = true;
  document.getElementById('manualTimeFields').style.display = 'none';
  showToast('â†º Systemzeit wiederhergestellt', 'green');
  closeModal('timeModal');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showView(id) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('view-' + id)?.classList.add('active');
  document.querySelectorAll('.nav-item').forEach(n => {
    if (n.textContent.toLowerCase().includes(id.toLowerCase().substring(0,4))) n.classList.add('active');
  });
  if (id === 'kalender') renderCalendar();
}
function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('open');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODALS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openModal(id) { document.getElementById(id).classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); }
document.querySelectorAll('.modal-overlay').forEach(m => {
  m.addEventListener('click', (e) => { if (e.target === m) m.classList.remove('open'); });
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const _colors = { amber:'#f59e0b', green:'#10b981', blue:'#3b82f6', red:'#ef4444' };

function showToast(msg, type='amber') {
  const container = document.getElementById('toasts');
  const t = document.createElement('div');
  t.className = 'toast';
  t.style.borderColor = _colors[type] || _colors.amber;
  t.textContent = msg;
  container.appendChild(t);
  setTimeout(() => { t.style.opacity='0'; t.style.transform='translateX(100%)'; t.style.transition='0.3s ease'; setTimeout(()=>t.remove(),300); }, 3500);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDashboard() {
  // Einsatztabelle
  const einsatzTbl = document.getElementById('einsatzTable');
  einsatzTbl.innerHTML = einsaetze.map(e => {
    const statusBadge = e.status === 'aktiv' ? 'badge-green' : e.status === 'transit' ? 'badge-amber' : 'badge-blue';
    return `<tr>
      <td class="font-mono text-amber">${e.id}</td>
      <td>${e.land} â€” ${e.standort}</td>
      <td><span class="badge badge-blue">Phase ${e.phase}</span></td>
      <td>${e.pers}</td>
      <td class="text-sm text-muted">${e.fahrzeuge}</td>
      <td><span class="badge ${statusBadge}">${e.statusLabel}</span></td>
      <td><button class="btn btn-ghost btn-sm" onclick="showView('phase${e.phase}')">Details</button></td>
    </tr>`;
  }).join('');

  // Dept progress
  const dp = document.getElementById('deptProgress');
  dp.innerHTML = depts.map(d => {
    const pct = Math.round((d.requests / 5) * 100);
    return `<div>
      <div class="flex justify-between items-center mb8">
        <span class="text-sm font-cond">${d.id}: ${d.name}</span>
        <span class="text-sm text-muted">${d.requests} Anforderungen</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" style="width:${pct}%; background:var(--${d.color})"></div>
      </div>
    </div>`;
  }).join('');

  // Activity
  const at = document.getElementById('activityTimeline');
  at.innerHTML = activities.map(a => `
    <div class="timeline-item">
      <div class="timeline-dot ${a.type}"></div>
      <div class="timeline-time">${a.time}</div>
      <div class="timeline-title">${a.title}</div>
      <div class="timeline-desc">${a.desc}</div>
    </div>
  `).join('');

  // Alerts
  const da = document.getElementById('dashAlerts');
  da.innerHTML = dashAlerts.map(a => `<div class="alert alert-${a.type}">${a.msg}</div>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER PHASE 2 LOCATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderPhase2() {
  const lc = document.getElementById('locationCards');
  lc.innerHTML = locations.map(l => `
    <div class="card">
      <div class="card-header">
        <div class="card-title">${l.name}</div>
        <span class="badge badge-green">Aktiv</span>
      </div>
      <div style="font-size:0.9rem; margin-bottom:8px;">${l.land}</div>
      <div class="flex justify-between mb8">
        <span class="text-muted text-sm">Personal</span>
        <span class="font-mono text-amber">${l.pers}</span>
      </div>
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:4px; font-size:0.8rem;">
        <div>ğŸ  ${l.unterkunft}</div>
        <div>ğŸ½ï¸ ${l.verpf}</div>
        <div>ğŸ§º ${l.waesche}</div>
        <div>ğŸš½ ${l.sanitaer}</div>
        <div>ğŸŒ ${l.it}</div>
        <div>ğŸ—‘ï¸ ${l.abfall}</div>
      </div>
    </div>
  `).join('');

  const lt = document.getElementById('locationTable');
  lt.innerHTML = locations.map(l => `
    <tr>
      <td class="font-mono text-amber">${l.id}</td>
      <td>${l.land}</td>
      <td>${l.pers}</td>
      <td>${l.unterkunft}</td>
      <td>${l.verpf}</td>
      <td>${l.waesche}</td>
      <td>${l.sanitaer}</td>
      <td>${l.it}</td>
      <td>${l.abfall}</td>
      <td><span class="badge badge-green">Aktiv</span></td>
    </tr>
  `).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER TRANSIT TABLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderTransit() {
  const tt = document.getElementById('transitTable');
  tt.innerHTML = transits.map(t => {
    const badge = t.status === 'aktiv' ? 'badge-amber' : t.status === 'abgeschlossen' ? 'badge-green' : t.status === 'verzÃ¶gert' ? 'badge-red' : 'badge-blue';
    return `<tr>
      <td class="font-mono text-amber">${t.id}</td>
      <td>${t.von} â†’ ${t.nach}</td>
      <td><span class="badge badge-blue">${t.typ}</span></td>
      <td>${t.pers}</td>
      <td class="text-sm text-muted">${t.material}</td>
      <td class="font-mono text-sm">${t.abfahrt}</td>
      <td class="font-mono text-sm">${t.eta}</td>
      <td class="text-sm">${t.grenze}</td>
      <td><span class="badge ${badge}">${t.status}</span></td>
    </tr>`;
  }).join('');

  // Checklists
  const renderCL = (containerId, items) => {
    document.getElementById(containerId).innerHTML = items.map((item,i) => `
      <label style="display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid var(--border);cursor:pointer;font-size:0.85rem;">
        <input type="checkbox" onchange="this.parentNode.style.opacity=this.checked?'0.5':'1'">
        <span>${item}</span>
      </label>
    `).join('');
  };
  renderCL('checklistHin', checlistHin);
  renderCL('checklistRueck', checklistRueck);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER SERVICES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderServices() {
  const services = [
    { icon:'ğŸ ', name:'Unterkunft', count:'302 Personen', status:'Operationell', statusType:'green' },
    { icon:'ğŸ½ï¸', name:'Verpflegung', count:'302 Mahlzeiten/Tag', status:'Operationell', statusType:'green' },
    { icon:'ğŸ§º', name:'WÃ¤scheservice', count:'3 Standorte aktiv', status:'EinschrÃ¤nkung', statusType:'amber' },
    { icon:'ğŸš½', name:'SanitÃ¤ranlagen', count:'64 Einheiten', status:'Operationell', statusType:'green' },
    { icon:'ğŸ—‘ï¸', name:'Abfallentsorgung', count:'3 Standorte', status:'EinschrÃ¤nkung', statusType:'amber' },
    { icon:'ğŸŒ', name:'IT & Kommunikation', count:'8 Standorte', status:'EingeschrÃ¤nkt', statusType:'amber' },
    { icon:'ğŸš›', name:'Transport', count:'84 Fahrzeuge', status:'Operationell', statusType:'green' },
    { icon:'âš¡', name:'Notstrom', count:'5 Standorte', status:'Bereit', statusType:'green' },
  ];

  document.getElementById('serviceCards').innerHTML = services.map(s => `
    <div class="service-card">
      <div class="service-icon">${s.icon}</div>
      <div class="service-name">${s.name}</div>
      <div class="service-count">${s.count}</div>
      <div class="service-status">
        <span style="width:6px;height:6px;border-radius:50%;background:var(--${s.statusType});display:inline-block;"></span>
        <span class="text-${s.statusType}">${s.status}</span>
      </div>
    </div>
  `).join('');

  // SLA table
  const sla = document.getElementById('slaTable');
  sla.innerHTML = `<table><thead><tr><th>Service</th><th>SLA</th><th>Aktuell</th><th>Status</th></tr></thead><tbody>
    ${slaData.map(s => `<tr>
      <td>${s.service}</td>
      <td class="font-mono">${s.sla}</td>
      <td class="font-mono text-${s.ok?'green':'red'}">${s.aktuell}</td>
      <td><span class="badge badge-${s.ok?'green':'red'}">${s.ok?'OK':'Unter SLA'}</span></td>
    </tr>`).join('')}
  </tbody></table>`;

  // Provider table
  const prov = document.getElementById('providerTable');
  prov.innerHTML = `<table><thead><tr><th>Dienstleister</th><th>Service</th><th>Status</th></tr></thead><tbody>
    <tr><td>Sodexo GmbH</td><td>Verpflegung</td><td><span class="badge badge-green">Aktiv</span></td></tr>
    <tr><td>DHL Supply Chain</td><td>Logistik</td><td><span class="badge badge-green">Aktiv</span></td></tr>
    <tr><td>TOI TOI & DIXI</td><td>SanitÃ¤r</td><td><span class="badge badge-green">Aktiv</span></td></tr>
    <tr><td>Telekom Business</td><td>IT / Internet</td><td><span class="badge badge-amber">SLA-PrÃ¼fung</span></td></tr>
    <tr><td>REMONDIS</td><td>Abfall</td><td><span class="badge badge-amber">Teilausfall</span></td></tr>
  </tbody></table>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER PERSONAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderPersonal() {
  renderPersonalTable(personal);
}

function renderPersonalTable(data) {
  const pt = document.getElementById('personalTable');
  pt.innerHTML = data.map(p => {
    const badge = p.status === 'Aktiv' ? 'badge-green' : p.status === 'Transit' ? 'badge-amber' : 'badge-blue';
    return `<tr>
      <td class="font-mono text-amber">${p.id}</td>
      <td>${p.name}</td>
      <td><span class="badge badge-blue">${p.abt}</span></td>
      <td>${p.standort}</td>
      <td>Phase ${p.phase}</td>
      <td class="text-sm">${p.unterkunft}</td>
      <td><span class="badge ${badge}">${p.status}</span></td>
      <td class="font-mono text-sm">${p.ein}</td>
      <td class="font-mono text-sm">${p.aus}</td>
    </tr>`;
  }).join('');
}

function filterPersonal(q) {
  const filtered = personal.filter(p =>
    p.name.toLowerCase().includes(q.toLowerCase()) ||
    p.abt.toLowerCase().includes(q.toLowerCase()) ||
    p.standort.toLowerCase().includes(q.toLowerCase())
  );
  renderPersonalTable(filtered);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER TRANSPORT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderTransport() {
  const tt = document.getElementById('transportTable');
  tt.innerHTML = transporte.map(t => {
    const badge = t.status === 'aktiv' ? 'badge-green' : 'badge-amber';
    return `<tr>
      <td class="font-mono text-amber">${t.id}</td>
      <td>${t.typ}</td>
      <td>${t.standort}</td>
      <td>${t.einsatz}</td>
      <td>${t.flaeche} mÂ²</td>
      <td>${t.ladung}</td>
      <td><span class="badge ${badge}">${t.status}</span></td>
    </tr>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER ABRECHNUNG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAbrechnung() {
  const rt = document.getElementById('rechnungTable');
  rt.innerHTML = rechnungen.map(r => {
    const badge = r.status === 'bezahlt' ? 'badge-green' : r.status === 'Ã¼berfÃ¤llig' ? 'badge-red' : 'badge-amber';
    return `<tr>
      <td class="font-mono text-amber">${r.nr}</td>
      <td>${r.empfaenger}</td>
      <td>${r.einsatz}</td>
      <td>${r.zeitraum}</td>
      <td class="font-mono fw7">${r.betrag}</td>
      <td class="font-mono text-sm">${r.faellig}</td>
      <td><span class="badge ${badge}">${r.status}</span></td>
      <td>
        <div class="flex gap8">
          <button class="btn btn-ghost btn-sm" onclick="showToast('ğŸ“„ PDF wird erstellt...','blue')">PDF</button>
          <button class="btn btn-ghost btn-sm">Senden</button>
        </div>
      </td>
    </tr>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER PARTNER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderPartner() {
  const pt = document.getElementById('partnerTable');
  pt.innerHTML = partner.map(p => `<tr>
    <td class="fw7">${p.name}</td>
    <td>${p.land}</td>
    <td><span class="badge badge-blue">${p.typ}</span></td>
    <td>${p.ap}</td>
    <td class="font-mono text-sm">${p.tel}</td>
    <td class="text-sm">${p.mail}</td>
    <td class="text-amber font-mono">${p.einsaetze}</td>
    <td class="font-mono text-sm">${p.bis}</td>
    <td><span class="badge badge-green">${p.status}</span></td>
  </tr>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER VORLAGEN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderVorlagen() {
  const vg = document.getElementById('vorlagenGrid');
  vg.innerHTML = vorlagen.map(v => `
    <div class="card" style="display:flex;flex-direction:column;gap:10px;">
      <div style="font-size:2rem">${v.icon}</div>
      <div>
        <div class="fw7 font-cond" style="font-size:1rem;">${v.name}</div>
        <div class="text-sm text-muted mt8">${v.desc}</div>
      </div>
      <div class="flex gap8 items-center">
        <span class="badge badge-blue">${v.type}</span>
        <span class="badge badge-gray">${v.format}</span>
      </div>
      <button class="btn btn-outline btn-sm w-full" onclick="downloadVorlage('${v.name}')">â¬‡ï¸ Herunterladen</button>
    </div>
  `).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VORLAGEN â€” Inhalt generieren & speichern (iOS)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const _vorlagenInhalte = {
  'Bedarfsanforderung (Standard)': {
    ext: 'html', mime: 'text/html',
    content: () => `<!DOCTYPE html><html lang="de"><head><meta charset="UTF-8">
<title>OPS360 â€” Bedarfsanforderung</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 800px; margin: 40px auto; padding: 20px; color: #222; }
  h1 { color: #1a2340; border-bottom: 3px solid #f59e0b; padding-bottom: 10px; }
  h2 { color: #1a2340; margin-top: 30px; font-size: 1rem; text-transform: uppercase; letter-spacing: 1px; }
  .feld { margin: 10px 0; display: flex; gap: 10px; align-items: baseline; }
  .label { font-weight: bold; min-width: 200px; font-size: 0.85rem; color: #555; }
  .linie { flex: 1; border-bottom: 1px solid #ccc; min-height: 20px; }
  .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .box { border: 1px solid #ccc; padding: 8px; min-height: 40px; }
  .header-info { background: #f8f9fa; padding: 15px; border: 1px solid #ddd; margin-bottom: 20px; }
  .footer { margin-top: 40px; border-top: 2px solid #1a2340; padding-top: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
  .sig-line { border-bottom: 1px solid #000; margin-top: 40px; }
  @media print { body { margin: 20px; } }
</style></head><body>

<h1>ğŸ“‹ BEDARFSANFORDERUNG</h1>
<div class="header-info">
  <div class="grid">
    <div><b>Anforderungs-ID:</b> BD-___________</div>
    <div><b>Datum:</b> _______________</div>
    <div><b>PrioritÃ¤t:</b> â˜ Normal &nbsp; â˜ ErhÃ¶ht &nbsp; â˜ Dringend &nbsp; â˜ Kritisch</div>
    <div><b>Klassifizierung:</b> â˜ OFFEN &nbsp; â˜ VS-NfD &nbsp; â˜ VERTRAULICH</div>
  </div>
</div>
<h2>1. Stammdaten</h2>
<div class="feld"><span class="label">Abteilung:</span>
  â˜ ABT-1: Planung &nbsp; â˜ ABT-2: Logistik &nbsp; â˜ ABT-3: Technik &nbsp; â˜ ABT-4: Infrastruktur &nbsp; â˜ ABT-5: Support
</div>
<div class="feld"><span class="label">Einsatz-Phase:</span> â˜ Phase 1 â€” Transit &nbsp; â˜ Phase 2 â€” Final Location &nbsp; â˜ Phase 1+2</div>
<div class="feld"><span class="label">Zielland / Region:</span><span class="linie"></span></div>
<div class="feld"><span class="label">Genauer Standort:</span><span class="linie"></span></div>
<div class="feld"><span class="label">Einsatzbeginn:</span><span class="linie"></span><span class="label" style="margin-left:20px">Einsatzende:</span><span class="linie"></span></div>
<div class="feld"><span class="label">Kostenstellencode:</span><span class="linie"></span><span class="label" style="margin-left:20px">Budget (EUR):</span><span class="linie"></span></div>
<div class="feld"><span class="label">ZustÃ¤ndige BehÃ¶rde:</span><span class="linie"></span></div>
<h2>2. Ansprechpartner</h2>
<div class="feld"><span class="label">Anforderer (Name):</span><span class="linie"></span></div>
<div class="feld"><span class="label">Telefon:</span><span class="linie"></span><span class="label" style="margin-left:20px">E-Mail:</span><span class="linie"></span></div>
<div class="feld"><span class="label">Einsatzleiter vor Ort:</span><span class="linie"></span></div>
<h2>3. Personal (20 â€“ 5.000 Personen)</h2>
<div class="grid">
  <div class="feld"><span class="label">Gesamtpersonal:</span><span class="linie"></span></div>
  <div class="feld"><span class="label">Davon Phase 1:</span><span class="linie"></span></div>
  <div class="feld"><span class="label">Davon Phase 2:</span><span class="linie"></span></div>
  <div class="feld"><span class="label">FÃ¼hrungspersonal:</span><span class="linie"></span></div>
</div>
<div class="feld"><span class="label">Unterkunftstyp:</span> â˜ Hotel &nbsp; â˜ Feldlager &nbsp; â˜ Modularbau &nbsp; â˜ Kaserne &nbsp; â˜ Gemischt</div>
<div class="feld"><span class="label">Zimmertyp:</span> â˜ Einzelzimmer &nbsp; â˜ Doppelzimmer &nbsp; â˜ Mehrbett (4) &nbsp; â˜ Mehrbett (6)</div>
<h2>4. Services</h2>
<div class="grid">
  <div>â˜ Vollverpflegung (3 Mahlzeiten)<br>â˜ Halbpension<br>â˜ Selbstversorgung</div>
  <div>â˜ WÃ¤sche tÃ¤glich<br>â˜ WÃ¤sche 2x/Woche<br>â˜ WÃ¤sche wÃ¶chentlich</div>
  <div>â˜ SanitÃ¤rcontainer (Anzahl: ___)<br>â˜ Vorhandene Infrastruktur<br>â˜ Mobile Toiletten</div>
  <div>â˜ WLAN<br>â˜ LAN<br>â˜ Satellit<br>â˜ VPN<br>â˜ Videokonferenz</div>
  <div>â˜ Abfall Standard<br>â˜ Abfall tÃ¤glich<br>â˜ Gefahrgut-Entsorgung</div>
  <div>â˜ Medizin / SanitÃ¤tsdienst<br>â˜ Notstromversorgung<br>â˜ Sicherheitsdienst</div>
</div>
<h2>5. Transport & Fahrzeuge</h2>
<table border="1" cellpadding="6" style="width:100%;border-collapse:collapse;font-size:0.85rem;">
  <tr style="background:#f0f0f0;"><th>Kategorie</th><th>Kennzeichen</th><th>Typ / Modell</th><th>KapazitÃ¤t</th><th>FlÃ¤che mÂ²</th><th>ADR</th></tr>
  <tr><td>LKW / PKW / Bus</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
  <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
  <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
  <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
</table>
<h2>6. Bemerkungen</h2>
<div class="box" style="min-height:80px"></div>
<div class="footer">
  <div><b>Unterschrift Anforderer:</b><div class="sig-line"></div><div style="font-size:0.75rem;margin-top:4px">Name, Datum</div></div>
  <div><b>Freigabe Vorgesetzter:</b><div class="sig-line"></div><div style="font-size:0.75rem;margin-top:4px">Name, Datum</div></div>
</div>
</body></html>`
  },
  'Transit-Checkliste Hinverlegung': {
    ext: 'html', mime: 'text/html',
    content: () => `<!DOCTYPE html><html lang="de"><head><meta charset="UTF-8"><title>Transit-Checkliste Hinverlegung</title>
<style>body{font-family:Arial,sans-serif;max-width:700px;margin:40px auto;padding:20px}h1{color:#1a2340;border-bottom:3px solid #f59e0b;padding-bottom:10px}
.item{display:flex;align-items:center;gap:12px;padding:10px;border-bottom:1px solid #eee;font-size:0.9rem}
.cb{width:18px;height:18px;border:2px solid #333;display:inline-block;flex-shrink:0}
.meta{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:20px;background:#f8f9fa;padding:15px;border:1px solid #ddd}
.sig{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:30px}
.sl{border-bottom:1px solid #000;margin-top:30px}
</style></head><body>
<h1>ğŸšš TRANSIT-CHECKLISTE â€” HINVERLEGUNG</h1>
<div class="meta">
  <div><b>Transit-ID:</b> TRN-_______</div><div><b>Datum:</b> ___________</div>
  <div><b>Von:</b> ___________</div><div><b>Nach:</b> ___________</div>
  <div><b>Personen:</b> ___________</div><div><b>Fahrzeuge:</b> ___________</div>
  <div><b>GrenzÃ¼bergang:</b> ___________</div><div><b>ETA:</b> ___________</div>
</div>
<h2>Vor Abfahrt</h2>
${['Marschbefehl erstellt und ausgegeben','Passierscheine / Visa fÃ¼r alle Personen vorhanden','GrenzÃ¼bertrittserlaubnis eingeholt','Fahrzeugpapiere vollstÃ¤ndig geprÃ¼ft','ADR-Dokumente vorhanden (falls Gefahrgut)','Unterkunft am Zielort schriftlich bestÃ¤tigt','Verpflegung fÃ¼r die Reise sichergestellt','Kommunikationsmittel geprÃ¼ft (Funk, Telefon)','Notfallkontakte alle Teilnehmer informiert','Einsatzbriefing durchgefÃ¼hrt'].map(i=>`<div class="item"><span class="cb"></span>${i}</div>`).join('')}
<h2>WÃ¤hrend Transit</h2>
${['RegelmÃ¤ÃŸige Lagemeldungen an Zentrale','GrenzÃ¼bertritt dokumentiert (Zeit, Stempel)','Fahrzeugzustand unterwegs geprÃ¼ft','PersonalzÃ¤hlung nach jedem Halt','Abweichungen sofort melden'].map(i=>`<div class="item"><span class="cb"></span>${i}</div>`).join('')}
<h2>Bei Ankunft</h2>
${['VollstÃ¤ndigkeitsprÃ¼fung Personal und Material','Ãœbergabe an EmpfÃ¤nger vor Ort','Ankunftsmeldung an Zentrale','Unterkunft bezogen und geprÃ¼ft','Erste Services aktiviert (Verpflegung, IT)'].map(i=>`<div class="item"><span class="cb"></span>${i}</div>`).join('')}
<h2>Bemerkungen</h2>
<div style="border:1px solid #ccc;min-height:60px;padding:8px;margin-bottom:20px"></div>
<div class="sig">
  <div><b>Einsatzleiter:</b><div class="sl"></div></div>
  <div><b>Datum / Uhrzeit:</b><div class="sl"></div></div>
</div></body></html>`
  },
  'Transit-Checkliste RÃ¼ckverlegung': {
    ext: 'html', mime: 'text/html',
    content: () => `<!DOCTYPE html><html lang="de"><head><meta charset="UTF-8"><title>Transit-Checkliste RÃ¼ckverlegung</title>
<style>body{font-family:Arial,sans-serif;max-width:700px;margin:40px auto;padding:20px}h1{color:#1a2340;border-bottom:3px solid #f59e0b;padding-bottom:10px}
.item{display:flex;align-items:center;gap:12px;padding:10px;border-bottom:1px solid #eee;font-size:0.9rem}
.cb{width:18px;height:18px;border:2px solid #333;display:inline-block;flex-shrink:0}
.meta{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:20px;background:#f8f9fa;padding:15px;border:1px solid #ddd}
.sig{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:30px}.sl{border-bottom:1px solid #000;margin-top:30px}
</style></head><body>
<h1>ğŸ”™ TRANSIT-CHECKLISTE â€” RÃœCKVERLEGUNG</h1>
<div class="meta">
  <div><b>Transit-ID:</b> TRN-_______</div><div><b>Datum:</b> ___________</div>
  <div><b>Von:</b> ___________</div><div><b>Nach:</b> ___________</div>
  <div><b>Personen:</b> ___________</div><div><b>Fahrzeuge:</b> ___________</div>
</div>
<h2>Vor RÃ¼ckreise</h2>
${['AusrÃ¼ckeliste vollstÃ¤ndig erstellt','Ãœbergabeprotokoll mit Gastgeber unterzeichnet','Container-Inventar vollstÃ¤ndig abgeschlossen','Alle SchlÃ¼ssel / Zugangskarten zurÃ¼ckgegeben','Abfall vollstÃ¤ndig entsorgt und dokumentiert','Gesamte IT-AusrÃ¼stung erfasst und verpackt','Alle Rechnungen gestellt / Abrechnung abgeschlossen','Zoll- und Ausfuhrdokumente vorbereitet','Abschlussfotos des Standorts gemacht','Einsatzabschlussbericht eingereicht'].map(i=>`<div class="item"><span class="cb"></span>${i}</div>`).join('')}
<h2>WÃ¤hrend RÃ¼cktransit</h2>
${['GrenzÃ¼bertritt dokumentiert','RegelmÃ¤ÃŸige Meldungen an Zentrale','VollstÃ¤ndigkeit Personal und Material geprÃ¼ft'].map(i=>`<div class="item"><span class="cb"></span>${i}</div>`).join('')}
<h2>Bei Ankunft Heimatstandort</h2>
${['PersonalÃ¼bernahme bestÃ¤tigt','Material-Inventar abgenommen','Fahrzeuge Ã¼bergeben und Zustand dokumentiert','Abschlussbericht an Leitung','Lessons Learned dokumentiert'].map(i=>`<div class="item"><span class="cb"></span>${i}</div>`).join('')}
<div class="sig">
  <div><b>Einsatzleiter:</b><div class="sl"></div></div>
  <div><b>Datum / Uhrzeit:</b><div class="sl"></div></div>
</div></body></html>`
  },
  'Standort-Einrichtungsprotokoll': {
    ext: 'html', mime: 'text/html',
    content: () => `<!DOCTYPE html><html lang="de"><head><meta charset="UTF-8"><title>Standort-Einrichtungsprotokoll</title>
<style>body{font-family:Arial,sans-serif;max-width:800px;margin:40px auto;padding:20px}h1{color:#1a2340;border-bottom:3px solid #f59e0b;padding-bottom:10px}
h2{color:#1a2340;font-size:0.9rem;text-transform:uppercase;margin-top:25px}
.row{display:flex;gap:10px;margin:8px 0;align-items:baseline}.label{min-width:180px;font-size:0.85rem;font-weight:bold;color:#555}.linie{flex:1;border-bottom:1px solid #ccc;min-height:18px}
table{width:100%;border-collapse:collapse;margin:10px 0}td,th{border:1px solid #ccc;padding:7px;font-size:0.85rem}th{background:#f0f0f0}
.sig{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:40px}.sl{border-bottom:1px solid #000;margin-top:30px}
</style></head><body>
<h1>ğŸ•ï¸ STANDORT-EINRICHTUNGSPROTOKOLL â€” PHASE 2</h1>
<h2>Standortdaten</h2>
<div class="row"><span class="label">Standort-ID:</span><span class="linie"></span></div>
<div class="row"><span class="label">Bezeichnung:</span><span class="linie"></span></div>
<div class="row"><span class="label">Land / Ort:</span><span class="linie"></span></div>
<div class="row"><span class="label">Koordinaten (GPS):</span><span class="linie"></span></div>
<div class="row"><span class="label">Einrichtungsdatum:</span><span class="linie"></span><span class="label" style="margin-left:15px">Verantwortlicher:</span><span class="linie"></span></div>
<h2>KapazitÃ¤t</h2>
<div class="row"><span class="label">Personenzahl:</span><span class="linie"></span><span class="label" style="margin-left:15px">Unterkunftstyp:</span><span class="linie"></span></div>
<div class="row"><span class="label">AbstellflÃ¤che mÂ²:</span><span class="linie"></span><span class="label" style="margin-left:15px">Container Anzahl:</span><span class="linie"></span></div>
<h2>Service-Abnahme</h2>
<table>
  <tr><th>Service</th><th>Anbieter</th><th>Status</th><th>Bemerkung</th></tr>
  <tr><td>ğŸ  Unterkunft</td><td></td><td>â˜ OK &nbsp; â˜ Mangel</td><td></td></tr>
  <tr><td>ğŸ½ï¸ Verpflegung</td><td></td><td>â˜ OK &nbsp; â˜ Mangel</td><td></td></tr>
  <tr><td>ğŸ§º WÃ¤scheservice</td><td></td><td>â˜ OK &nbsp; â˜ Mangel</td><td></td></tr>
  <tr><td>ğŸš½ SanitÃ¤ranlagen</td><td></td><td>â˜ OK &nbsp; â˜ Mangel</td><td></td></tr>
  <tr><td>ğŸ—‘ï¸ Abfallentsorgung</td><td></td><td>â˜ OK &nbsp; â˜ Mangel</td><td></td></tr>
  <tr><td>ğŸŒ IT / Internet</td><td></td><td>â˜ OK &nbsp; â˜ Mangel</td><td></td></tr>
  <tr><td>ğŸš› Transport</td><td></td><td>â˜ OK &nbsp; â˜ Mangel</td><td></td></tr>
  <tr><td>âš¡ Notstrom</td><td></td><td>â˜ OK &nbsp; â˜ Mangel</td><td></td></tr>
</table>
<h2>MÃ¤ngelliste</h2>
<div style="border:1px solid #ccc;min-height:80px;padding:8px;margin-bottom:10px"></div>
<div class="sig">
  <div><b>Einrichtungsleiter:</b><div class="sl"></div></div>
  <div><b>BehÃ¶rde / Gastgeber:</b><div class="sl"></div></div>
</div></body></html>`
  },
  'BehÃ¶rden-Abstimmungsprotokoll': {
    ext: 'html', mime: 'text/html',
    content: () => `<!DOCTYPE html><html lang="de"><head><meta charset="UTF-8"><title>BehÃ¶rden-Abstimmungsprotokoll</title>
<style>body{font-family:Arial,sans-serif;max-width:800px;margin:40px auto;padding:20px}h1{color:#1a2340;border-bottom:3px solid #f59e0b;padding-bottom:10px}
h2{font-size:0.9rem;text-transform:uppercase;color:#1a2340;margin-top:20px}
.row{display:flex;gap:10px;margin:8px 0;align-items:baseline}.label{min-width:180px;font-size:0.85rem;font-weight:bold;color:#555}.linie{flex:1;border-bottom:1px solid #ccc;min-height:18px}
table{width:100%;border-collapse:collapse;margin:10px 0}td,th{border:1px solid #ccc;padding:7px;font-size:0.85rem}th{background:#f0f0f0}
.sig{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:40px}.sl{border-bottom:1px solid #000;margin-top:30px}
</style></head><body>
<h1>ğŸ¤ BEHÃ–RDEN-ABSTIMMUNGSPROTOKOLL</h1>
<h2>Meetingdaten</h2>
<div class="row"><span class="label">Datum / Uhrzeit:</span><span class="linie"></span></div>
<div class="row"><span class="label">Ort / Format:</span><span class="linie"></span></div>
<div class="row"><span class="label">Bezug (Einsatz-ID):</span><span class="linie"></span></div>
<h2>Teilnehmer</h2>
<table>
  <tr><th>Name</th><th>Organisation / BehÃ¶rde</th><th>Funktion</th><th>Kontakt</th></tr>
  <tr><td></td><td></td><td></td><td></td></tr>
  <tr><td></td><td></td><td></td><td></td></tr>
  <tr><td></td><td></td><td></td><td></td></tr>
  <tr><td></td><td></td><td></td><td></td></tr>
</table>
<h2>Besprochene Punkte</h2>
<table>
  <tr><th>#</th><th>Thema</th><th>Ergebnis / Vereinbarung</th><th>Verantwortlich</th><th>Bis wann</th></tr>
  <tr><td>1</td><td></td><td></td><td></td><td></td></tr>
  <tr><td>2</td><td></td><td></td><td></td><td></td></tr>
  <tr><td>3</td><td></td><td></td><td></td><td></td></tr>
  <tr><td>4</td><td></td><td></td><td></td><td></td></tr>
  <tr><td>5</td><td></td><td></td><td></td><td></td></tr>
</table>
<h2>Offene Punkte / NÃ¤chste Schritte</h2>
<div style="border:1px solid #ccc;min-height:60px;padding:8px;margin-bottom:10px"></div>
<h2>NÃ¤chstes Meeting</h2>
<div class="row"><span class="label">Datum:</span><span class="linie"></span><span class="label" style="margin-left:15px">Ort:</span><span class="linie"></span></div>
<div class="sig">
  <div><b>OPS360-Vertreter:</b><div class="sl"></div></div>
  <div><b>BehÃ¶rdenvertreter:</b><div class="sl"></div></div>
</div></body></html>`
  },
  'Abrechnungsvorlage': {
    ext: 'html', mime: 'text/html',
    content: () => `<!DOCTYPE html><html lang="de"><head><meta charset="UTF-8"><title>Abrechnungsvorlage</title>
<style>body{font-family:Arial,sans-serif;max-width:800px;margin:40px auto;padding:20px}
.header{display:flex;justify-content:space-between;margin-bottom:30px}
h1{color:#1a2340;font-size:1.4rem}
.rg-nr{font-size:1.2rem;font-weight:bold;color:#f59e0b}
table{width:100%;border-collapse:collapse;margin:20px 0}td,th{border:1px solid #ddd;padding:8px;font-size:0.85rem}th{background:#1a2340;color:white}
.summe{text-align:right;font-size:0.9rem}.summe td{border:none;padding:4px 8px}.total{font-weight:bold;font-size:1rem;border-top:2px solid #000!important}
.footer{margin-top:40px;font-size:0.8rem;color:#666;border-top:1px solid #ddd;padding-top:15px}
.row{display:flex;gap:10px;margin:6px 0}.label{min-width:180px;font-weight:bold;font-size:0.85rem}.val{flex:1;border-bottom:1px solid #ccc}
</style></head><body>
<div class="header">
  <div><h1>RECHNUNG / ABRECHNUNG</h1><div style="font-size:0.8rem;color:#666">OPS360 â€” Global Operations</div></div>
  <div style="text-align:right"><div class="rg-nr">RG-______-___</div><div style="font-size:0.8rem;margin-top:4px">Datum: ___________</div></div>
</div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:30px;margin-bottom:20px">
  <div><b>Rechnungssteller:</b><br>___________________<br>___________________<br>___________________</div>
  <div><b>RechnungsempfÃ¤nger / BehÃ¶rde:</b><br>___________________<br>___________________<br>___________________</div>
</div>
<div class="row"><span class="label">Bezug / Einsatz-ID:</span><span class="val"></span></div>
<div class="row"><span class="label">Leistungszeitraum:</span><span class="val"></span></div>
<div class="row"><span class="label">Kostenstellencode:</span><span class="val"></span></div>
<table>
  <tr><th>Pos.</th><th>Leistungsbeschreibung</th><th>Menge</th><th>Einheit</th><th>Einzelpreis (EUR)</th><th>Gesamt (EUR)</th></tr>
  <tr><td>1</td><td>Unterkunft</td><td></td><td>NÃ¤chte/Pers.</td><td></td><td></td></tr>
  <tr><td>2</td><td>Verpflegung</td><td></td><td>Tage/Pers.</td><td></td><td></td></tr>
  <tr><td>3</td><td>WÃ¤scheservice</td><td></td><td>Pauschal</td><td></td><td></td></tr>
  <tr><td>4</td><td>SanitÃ¤ranlagen</td><td></td><td>Pauschal</td><td></td><td></td></tr>
  <tr><td>5</td><td>IT / Kommunikation</td><td></td><td>Pauschal</td><td></td><td></td></tr>
  <tr><td>6</td><td>Transport / Fahrzeuge</td><td></td><td>Pauschal</td><td></td><td></td></tr>
  <tr><td>7</td><td>Abfallentsorgung</td><td></td><td>Pauschal</td><td></td><td></td></tr>
  <tr><td>8</td><td>Sonstige Leistungen</td><td></td><td></td><td></td><td></td></tr>
</table>
<table class="summe" style="width:300px;margin-left:auto">
  <tr><td>Nettobetrag:</td><td style="text-align:right">____________ EUR</td></tr>
  <tr><td>MwSt. (19%):</td><td style="text-align:right">____________ EUR</td></tr>
  <tr class="total"><td><b>Gesamtbetrag:</b></td><td style="text-align:right"><b>____________ EUR</b></td></tr>
</table>
<div style="margin-top:20px;font-size:0.85rem">
  <b>Zahlungsziel:</b> 30 Tage nach Rechnungseingang<br>
  <b>Bankverbindung:</b> IBAN: ___________________________ BIC: _______________
</div>
<div class="footer">OPS360 Global Operations Â· Erstellt mit OPS360 Management System</div>
</body></html>`
  },
  'Personalliste (Masseneintrag)': {
    ext: 'csv', mime: 'text/csv',
    content: () => `Nachname;Vorname;Personal-ID;Abteilung;Funktion;Standort;Phase;Unterkunft;Check-in;Check-out;Bemerkung
Mustermann;Hans;P-0001;ABT-1: Planung;Techniker;Lyon-Est;2;Hotel Ibis 204;2026-03-01;2026-04-01;
Musterfrau;Anna;P-0002;ABT-2: Logistik;Fahrerin;Warschau;2;Container C-12;2026-03-01;2026-03-31;
;  ;P-0003;ABT-3: Technik;;  ;1;;;  ;
;  ;P-0004;ABT-4: Infrastruktur;;  ;2;;;  ;
;  ;P-0005;ABT-5: Support;;  ;2;;;  ;`
  },
  'Fahrzeug- & Containerliste': {
    ext: 'csv', mime: 'text/csv',
    content: () => `Kategorie;Kennzeichen;Typ/Modell;KapazitÃ¤t;AbstellflÃ¤che_m2;ADR-Klasse;Standort;Einsatz-ID;Status;Bemerkung
LKW;B-AB 1234;Standard-LKW 7,5t;7,5t;42;Kein ADR;Lyon-Est;EIN-002;Aktiv;
LKW;MUC-XY 999;Schwerlast-LKW 40t;40t;56;Kein ADR;Warschau;EIN-003;Aktiv;
PKW;K-ZZ 1111;GelÃ¤ndefahrzeug SUV;5 Pax;8;Kein ADR;BrÃ¼ssel;EIN-005;Aktiv;
Container;;20-FuÃŸ-Standard;;14;Kein ADR;;;Geplant;
Container;;BÃ¼rocontainer;;14;Kein ADR;;;Geplant;`
  },
  'Lagebericht Vorlage': {
    ext: 'html', mime: 'text/html',
    content: () => `<!DOCTYPE html><html lang="de"><head><meta charset="UTF-8"><title>Lagebericht</title>
<style>body{font-family:Arial,sans-serif;max-width:800px;margin:40px auto;padding:20px}h1{color:#1a2340;border-bottom:3px solid #f59e0b;padding-bottom:10px}
h2{font-size:0.9rem;text-transform:uppercase;color:#1a2340;margin-top:20px;background:#f0f0f0;padding:6px 10px}
.row{display:flex;gap:10px;margin:8px 0}.label{min-width:160px;font-weight:bold;font-size:0.85rem}.linie{flex:1;border-bottom:1px solid #ccc;min-height:18px}
table{width:100%;border-collapse:collapse;margin:10px 0}td,th{border:1px solid #ccc;padding:7px;font-size:0.85rem}th{background:#1a2340;color:white}
.box{border:1px solid #ccc;min-height:60px;padding:8px;margin:8px 0}
.ampel{display:inline-block;width:14px;height:14px;border-radius:50%;margin-right:6px;vertical-align:middle}
.gruen{background:#10b981}.gelb{background:#f59e0b}.rot{background:#ef4444}
</style></head><body>
<h1>ğŸ“Š WÃ–CHENTLICHER LAGEBERICHT</h1>
<div class="row"><span class="label">Berichtswoche:</span><span class="linie"></span><span class="label" style="margin-left:15px">Erstellt von:</span><span class="linie"></span></div>
<div class="row"><span class="label">Datum:</span><span class="linie"></span><span class="label" style="margin-left:15px">Verteiler:</span><span class="linie"></span></div>
<h2>1. Gesamtlage</h2>
<div style="margin:10px 0">
  <span class="ampel gruen"></span>GrÃ¼n â€” Alles im Plan &nbsp;
  <span class="ampel gelb"></span>Gelb â€” EingeschrÃ¤nkt &nbsp;
  <span class="ampel rot"></span>Rot â€” Kritisch
</div>
<div class="box"></div>
<h2>2. Standort-Status</h2>
<table>
  <tr><th>Standort</th><th>Land</th><th>Personal</th><th>Services</th><th>Lage</th></tr>
  <tr><td></td><td></td><td></td><td></td><td>â˜ğŸŸ¢ â˜ğŸŸ¡ â˜ğŸ”´</td></tr>
  <tr><td></td><td></td><td></td><td></td><td>â˜ğŸŸ¢ â˜ğŸŸ¡ â˜ğŸ”´</td></tr>
  <tr><td></td><td></td><td></td><td></td><td>â˜ğŸŸ¢ â˜ğŸŸ¡ â˜ğŸ”´</td></tr>
</table>
<h2>3. Transits dieser Woche</h2>
<table>
  <tr><th>Transit-ID</th><th>Von â†’ Nach</th><th>Personen</th><th>Status</th></tr>
  <tr><td></td><td></td><td></td><td></td></tr>
  <tr><td></td><td></td><td></td><td></td></tr>
</table>
<h2>4. Probleme / Abweichungen</h2>
<div class="box"></div>
<h2>5. MaÃŸnahmen nÃ¤chste Woche</h2>
<div class="box"></div>
<h2>6. Finanzen</h2>
<div class="row"><span class="label">Ausgaben diese Woche:</span><span class="linie"></span><span class="label" style="margin-left:15px">Budget gesamt:</span><span class="linie"></span></div>
</body></html>`
  },
  'Ãœbergabe-/Abnahmeprotokoll': {
    ext: 'html', mime: 'text/html',
    content: () => `<!DOCTYPE html><html lang="de"><head><meta charset="UTF-8"><title>Ãœbergabeprotokoll</title>
<style>body{font-family:Arial,sans-serif;max-width:800px;margin:40px auto;padding:20px}h1{color:#1a2340;border-bottom:3px solid #f59e0b;padding-bottom:10px}
h2{font-size:0.9rem;text-transform:uppercase;color:#1a2340;margin-top:20px}
.row{display:flex;gap:10px;margin:8px 0}.label{min-width:180px;font-weight:bold;font-size:0.85rem}.linie{flex:1;border-bottom:1px solid #ccc;min-height:18px}
table{width:100%;border-collapse:collapse;margin:10px 0}td,th{border:1px solid #ccc;padding:7px;font-size:0.85rem}th{background:#f0f0f0}
.sig{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:40px}.sl{border-bottom:1px solid #000;margin-top:30px}
</style></head><body>
<h1>âœ… ÃœBERGABE- / ABNAHMEPROTOKOLL</h1>
<div class="row"><span class="label">Standort / Einsatz-ID:</span><span class="linie"></span></div>
<div class="row"><span class="label">Datum Ãœbergabe:</span><span class="linie"></span><span class="label" style="margin-left:15px">Uhrzeit:</span><span class="linie"></span></div>
<h2>Ãœbergabe Services</h2>
<table>
  <tr><th>Service</th><th>Zustand bei Ãœbernahme</th><th>Zustand bei Ãœbergabe</th><th>MÃ¤ngel</th><th>Abgenommen</th></tr>
  <tr><td>Unterkunft</td><td></td><td></td><td></td><td>â˜ Ja â˜ Nein</td></tr>
  <tr><td>Verpflegung</td><td></td><td></td><td></td><td>â˜ Ja â˜ Nein</td></tr>
  <tr><td>WÃ¤scheservice</td><td></td><td></td><td></td><td>â˜ Ja â˜ Nein</td></tr>
  <tr><td>SanitÃ¤ranlagen</td><td></td><td></td><td></td><td>â˜ Ja â˜ Nein</td></tr>
  <tr><td>IT / Kommunikation</td><td></td><td></td><td></td><td>â˜ Ja â˜ Nein</td></tr>
  <tr><td>Abfallentsorgung</td><td></td><td></td><td></td><td>â˜ Ja â˜ Nein</td></tr>
  <tr><td>Fahrzeuge / FlÃ¤chen</td><td></td><td></td><td></td><td>â˜ Ja â˜ Nein</td></tr>
</table>
<h2>SchlÃ¼ssel / Zugangskarten</h2>
<table>
  <tr><th>Bezeichnung</th><th>Anzahl Ã¼bergeben</th><th>Anzahl zurÃ¼ck</th><th>OK</th></tr>
  <tr><td></td><td></td><td></td><td>â˜</td></tr>
  <tr><td></td><td></td><td></td><td>â˜</td></tr>
</table>
<h2>Bemerkungen</h2>
<div style="border:1px solid #ccc;min-height:60px;padding:8px;margin-bottom:20px"></div>
<div class="sig">
  <div><b>Ãœbergeber (OPS360):</b><div class="sl"></div></div>
  <div><b>Ãœbernehmer / BehÃ¶rde:</b><div class="sl"></div></div>
</div></body></html>`
  },
  'Kontakt- & Notrufkarte': {
    ext: 'html', mime: 'text/html',
    content: () => `<!DOCTYPE html><html lang="de"><head><meta charset="UTF-8"><title>Kontakt- und Notrufkarte</title>
<style>body{font-family:Arial,sans-serif;max-width:600px;margin:40px auto;padding:20px}
h1{color:#1a2340;border-bottom:3px solid #f59e0b;padding-bottom:10px;font-size:1.2rem}
table{width:100%;border-collapse:collapse;margin:15px 0}td,th{border:1px solid #ccc;padding:8px;font-size:0.85rem}
th{background:#1a2340;color:white}.rot{background:#fee2e2}.gelb{background:#fef9c3}
.notruf{font-size:1.1rem;font-weight:bold;color:#ef4444}
</style></head><body>
<h1>ğŸ“ KONTAKT- & NOTRUFKARTE â€” OPS360</h1>
<table>
  <tr><th colspan="3">ğŸš¨ NOTRUFNUMMERN</th></tr>
  <tr class="rot"><td class="notruf">Euronotruf</td><td class="notruf">112</td><td>EU-weit</td></tr>
  <tr class="rot"><td class="notruf">Polizei DE</td><td class="notruf">110</td><td>Deutschland</td></tr>
  <tr><td>Polizei FR</td><td>17</td><td>Frankreich</td></tr>
  <tr><td>Polizei PL</td><td>997</td><td>Polen</td></tr>
  <tr><td>Polizei BE</td><td>101</td><td>Belgien</td></tr>
</table>
<table>
  <tr><th>Funktion</th><th>Name</th><th>Telefon</th><th>E-Mail</th></tr>
  <tr><td>OPS-Leiter Zentrale</td><td></td><td></td><td></td></tr>
  <tr><td>Einsatzleiter vor Ort</td><td></td><td></td><td></td></tr>
  <tr><td>BehÃ¶rde Zielland</td><td></td><td></td><td></td></tr>
  <tr><td>Transportkoordinator</td><td></td><td></td><td></td></tr>
  <tr><td>IT-Support</td><td></td><td></td><td></td></tr>
  <tr><td>Medizin / SanitÃ¤ter</td><td></td><td></td><td></td></tr>
  <tr><td>Unterkunft (Rezeption)</td><td></td><td></td><td></td></tr>
  <tr><td>Verpflegungsdienstleister</td><td></td><td></td><td></td></tr>
</table>
<div style="background:#fef9c3;border:1px solid #f59e0b;padding:10px;margin-top:15px;font-size:0.8rem">
  <b>Im Notfall:</b> Ruhe bewahren â€” Notruf wÃ¤hlen â€” OPS-Leiter informieren â€” Standort mitteilen
</div>
</body></html>`
  },
  'Sicherheitsunterweisung': {
    ext: 'html', mime: 'text/html',
    content: () => `<!DOCTYPE html><html lang="de"><head><meta charset="UTF-8"><title>Sicherheitsunterweisung</title>
<style>body{font-family:Arial,sans-serif;max-width:800px;margin:40px auto;padding:20px}
h1{color:#1a2340;border-bottom:3px solid #f59e0b;padding-bottom:10px}
h2{color:#1a2340;font-size:0.95rem;text-transform:uppercase;margin-top:25px;background:#f0f0f0;padding:8px 12px}
ul{margin:10px 0;padding-left:20px}li{margin:6px 0;font-size:0.9rem}
.box{border:2px solid #ef4444;background:#fee2e2;padding:12px;border-radius:4px;margin:15px 0}
.sig{display:grid;grid-template-columns:1fr 1fr 1fr;gap:15px;margin-top:40px}.sl{border-bottom:1px solid #000;margin-top:25px;font-size:0.75rem;color:#666;margin-top:4px}
table{width:100%;border-collapse:collapse;margin:10px 0}td,th{border:1px solid #ccc;padding:7px;font-size:0.85rem}th{background:#1a2340;color:white}
</style></head><body>
<h1>ğŸ›¡ï¸ SICHERHEITSUNTERWEISUNG â€” EINSATZ-BRIEFING</h1>
<div class="box">âš ï¸ Diese Unterweisung ist verpflichtend. Alle Teilnehmer bestÃ¤tigen mit Unterschrift die Kenntnisnahme.</div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px;background:#f8f9fa;padding:12px;border:1px solid #ddd">
  <div><b>Einsatz-ID:</b> ___________</div><div><b>Datum:</b> ___________</div>
  <div><b>Standort / Land:</b> ___________</div><div><b>Unterweiser:</b> ___________</div>
</div>
<h2>1. Allgemeine Verhaltensregeln</h2>
<ul>
  <li>Ausweise / Dienstausweise stets mitfÃ¼hren</li>
  <li>Keine Fotos / Filmaufnahmen ohne Genehmigung</li>
  <li>Meldepflicht bei UnregelmÃ¤ÃŸigkeiten an Einsatzleiter</li>
  <li>Alkohol- und Drogenverbot wÃ¤hrend des Dienstes</li>
  <li>Kommunikationsregeln (was darf nach auÃŸen kommuniziert werden?)</li>
</ul>
<h2>2. Sicherheitsrelevante Ortsbegebenheiten</h2>
<ul>
  <li>Lageskizze / Evakuierungsrouten bekannt machen</li>
  <li>Sammelplatz im Notfall: ___________________________</li>
  <li>Verbotene Bereiche: ___________________________</li>
</ul>
<h2>3. Notfallverfahren</h2>
<ul>
  <li>Notruf: 112 (EU) â€” sofort wÃ¤hlen bei Gefahr fÃ¼r Leib und Leben</li>
  <li>OPS-Leiter informieren: ___________________________</li>
  <li>Evakuierung: Sammelplatz aufsuchen, VollzÃ¤hligkeit melden</li>
  <li>Brand: FeuerlÃ¶scher / Brandmelder Standort bekannt?</li>
</ul>
<h2>4. Gesundheitsschutz</h2>
<ul>
  <li>Medizinische Erstversorgung: ___________________________</li>
  <li>NÃ¤chstes Krankenhaus: ___________________________</li>
  <li>Impfanforderungen fÃ¼r dieses Land: ___________________________</li>
</ul>
<h2>5. Teilnehmerliste â€” BestÃ¤tigung</h2>
<table>
  <tr><th>#</th><th>Nachname</th><th>Vorname</th><th>Personal-ID</th><th>Unterschrift</th></tr>
  ${Array.from({length:10},(_,i)=>`<tr><td>${i+1}</td><td></td><td></td><td></td><td></td></tr>`).join('')}
</table>
</body></html>`
  }
};

async function downloadVorlage(name) {
const vorlage = _vorlagenInhalte[name];
if (!vorlage) { showToast(â€˜âš ï¸ Vorlage nicht gefundenâ€™, â€˜redâ€™); return; }

const inhalt = vorlage.content();
const blob = new Blob([inhalt], { type: vorlage.mime + â€˜;charset=utf-8â€™ });
const dateiname = name.replace(/[^a-zA-Z0-9Ã¤Ã¶Ã¼Ã„Ã–ÃœÃŸ\s]/g,â€™â€™).replace(/\s+/g,â€™-â€™) + â€˜.â€™ + vorlage.ext;
const file = new File([blob], dateiname, { type: vorlage.mime });
const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

// iOS: Web Share API â†’ nativer Speicherdialog
if (isIOS && navigator.canShare && navigator.canShare({ files: [file] })) {
try {
await navigator.share({ files: [file], title: name });
return;
} catch(e) {
if (e.name === â€˜AbortErrorâ€™) return;
}
}

// Desktop / Fallback
const url = URL.createObjectURL(blob);
const a = document.createElement(â€˜aâ€™);
a.href = url; a.download = dateiname;
document.body.appendChild(a); a.click();
setTimeout(() => { URL.revokeObjectURL(url); a.remove(); }, 1000);
showToast(â€˜ğŸ“¥ â€™ + dateiname + â€™ wird gespeichertâ€¦â€™, â€˜blueâ€™);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER ABTEILUNGEN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAbteilungen() {
const ac = document.getElementById(â€˜abteilungCardsâ€™);
ac.innerHTML = depts.map(d => `<div class="card"> <div class="card-header"> <div class="card-title">${d.id}</div> <span class="badge badge-${d.color === 'amber' ? 'amber' : d.color === 'blue' ? 'blue' : d.color === 'green' ? 'green' : 'red'}">${d.requests} Anforderungen</span> </div> <div class="fw7 font-cond" style="font-size:1.2rem; margin-bottom:8px;">${d.name}</div> <div class="text-sm text-muted mb16">Leiter: ${d.lead}</div> <div class="flex gap8"> <button class="btn btn-outline btn-sm" onclick="showView('bedarfsanforderung'); selectDeptById('${d.id}')">Neue Anforderung</button> <button class="btn btn-ghost btn-sm">Anforderungen anzeigen</button> </div> </div>`).join(â€™â€™);

// Settings dept config
const dc = document.getElementById(â€˜deptConfigâ€™);
if (dc) {
dc.innerHTML = depts.map(d => `<div style="display:flex; align-items:center; gap:12px; padding:10px 0; border-bottom:1px solid var(--border);"> <div style="flex:1;"> <div class="font-cond fw7">${d.id}: ${d.name}</div> <div class="text-xs text-muted">Leiter: ${d.lead}</div> </div> <input class="form-control" style="width:160px" value="${d.lead}" placeholder="Leiter"> </div>`).join(â€™â€™);
}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER CALENDAR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderCalendar() {
const strip = document.getElementById(â€˜calStripâ€™);
const today = new Date();
strip.innerHTML = â€˜â€™;
for (let i = 0; i < 30; i++) {
const d = new Date(today); d.setDate(today.getDate() + i);
const ds = d.toISOString().substring(0,10);
const hasEvent = kalenderEvents.some(e => e.datum === ds);
const day = document.createElement(â€˜divâ€™);
day.className = â€˜cal-dayâ€™ + (i===0?â€™ activeâ€™:â€™â€™) + (hasEvent?â€™ has-eventâ€™:â€™â€™);
const wd = d.toLocaleDateString(â€˜de-DEâ€™,{weekday:â€˜shortâ€™});
const dn = d.getDate();
day.innerHTML = `<div class="cal-day-name">${wd}</div><div class="cal-day-num">${dn}</div>${hasEvent?'<div class="cal-event-dot"></div>':''}`;
day.onclick = () => { document.querySelectorAll(â€™.cal-dayâ€™).forEach(x=>x.classList.remove(â€˜activeâ€™)); day.classList.add(â€˜activeâ€™); };
strip.appendChild(day);
}

const kt = document.getElementById(â€˜kalenderTableâ€™);
kt.innerHTML = kalenderEvents.map(e => `<tr>
<td class="font-mono text-amber">${e.datum}</td>
<td>${e.name}</td>
<td><span class="badge badge-blue">${e.abt}</span></td>
<td>${e.land}</td>
<td>${e.pers > 0 ? e.pers : â€˜â€”â€™}</td>
<td><span class="badge badge-gray">${e.typ}</span></td>

  </tr>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FORM STEPS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentStep = 1;

function showStep(step) {
for (let i=1; i<=5; i++) {
const el = document.getElementById(â€˜formStepâ€™+i);
if (el) el.style.display = i===step ? â€˜blockâ€™ : â€˜noneâ€™;
const sEl = document.getElementById(â€˜stepâ€™+i);
if (sEl) {
sEl.classList.remove(â€˜activeâ€™,â€˜doneâ€™);
if (i < step) sEl.classList.add(â€˜doneâ€™);
if (i === step) sEl.classList.add(â€˜activeâ€™);
}
const lineEl = document.getElementById(â€˜lineâ€™+i+(i+1));
if (lineEl) lineEl.classList.toggle(â€˜doneâ€™, i < step);
}
document.getElementById(â€˜prevStepBtnâ€™).style.visibility = step > 1 ? â€˜visibleâ€™ : â€˜hiddenâ€™;
document.getElementById(â€˜nextStepBtnâ€™).textContent = step === 5 ? â€˜Einreichen âœ…â€™ : â€˜Weiter â–¶â€™;
document.getElementById(â€˜stepLabelâ€™).textContent = â€˜Schritt â€™ + step + â€™ von 5â€™;
if (step === 5) updateSummary();
}

function nextStep() {
if (currentStep < 5) { currentStep++; showStep(currentStep); }
else submitBedarfsanforderung();
}

function prevStep() {
if (currentStep > 1) { currentStepâ€“; showStep(currentStep); }
}

function updateSummary() {
const abt = document.getElementById(â€˜bdAbtâ€™)?.value || â€˜â€™;
const phase = document.getElementById(â€˜bdPhaseâ€™)?.value || â€˜â€™;
const land = document.getElementById(â€˜bdLandâ€™)?.value || â€˜â€™;
const standort = document.getElementById(â€˜bdStandortâ€™)?.value || â€˜â€™;
const beginn = document.getElementById(â€˜bdBeginnâ€™)?.value || â€˜â€™;
const ende = document.getElementById(â€˜bdEndeâ€™)?.value || â€˜â€™;
const pers = document.getElementById(â€˜personalInputâ€™)?.value || â€˜0â€™;
const lkw = document.getElementById(â€˜tLkwâ€™)?.value || â€˜0â€™;
const pkw = document.getElementById(â€˜tPkwâ€™)?.value || â€˜0â€™;
const container = document.getElementById(â€˜tContainerâ€™)?.value || â€˜0â€™;
const budget = document.getElementById(â€˜bdBudgetâ€™)?.value || â€˜0â€™;
const prio = document.getElementById(â€˜bdPrioâ€™)?.value || â€˜â€™;
const anf = document.getElementById(â€˜bdAnfordererâ€™)?.value || â€˜â€™;

const s = `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BEDARFSANFORDERUNG â€” ZUSAMMENFASSUNG â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Abteilung        : ${abt} Phase            : Phase ${phase} PrioritÃ¤t        : ${prio} â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ EINSATZ Land / Standort  : ${land} / ${standort} Beginn           : ${beginn} Ende             : ${ende} â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ PERSONAL & SERVICES Gesamtpersonal   : ${pers} Personen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TRANSPORT LKW              : ${lkw} PKW              : ${pkw} Container        : ${container} â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ FINANZEN Budget (EUR)     : ${budget} â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Anforderer       : ${anf} â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`;

document.getElementById(â€˜summaryContentâ€™).textContent = s;
}

function submitBedarfsanforderung() {
const id = â€˜BD-â€™ + String(Date.now()).slice(-5);
document.getElementById(â€˜bdIdâ€™).value = id;
showToast(â€˜âœ… Anforderung â€™ + id + â€™ erfolgreich eingereicht!â€™, â€˜greenâ€™);
currentStep = 1;
showStep(1);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BEDARFSFORMULAR DEPT SELECTOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function selectDept(el, id) {
document.querySelectorAll(â€™.dept-tabâ€™).forEach(t => t.classList.remove(â€˜activeâ€™));
el.classList.add(â€˜activeâ€™);
const sel = document.getElementById(â€˜bdAbtâ€™);
if (sel) {
for (let opt of sel.options) {
if (opt.value.includes(id) || opt.text.includes(id)) { opt.selected = true; break; }
}
}
}

function selectDeptById(id) {
const tabs = document.querySelectorAll(â€™.dept-tabâ€™);
tabs.forEach((t,i) => {
t.classList.remove(â€˜activeâ€™);
if (t.textContent.includes(id)) t.classList.add(â€˜activeâ€™);
});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PERSONAL SLIDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updatePersonalSlider() {
const v = document.getElementById(â€˜personalSliderâ€™).value;
document.getElementById(â€˜personalValâ€™).textContent = v;
document.getElementById(â€˜personalInputâ€™).value = v;
}
function syncPersonalInput() {
const v = document.getElementById(â€˜personalInputâ€™).value;
document.getElementById(â€˜personalSliderâ€™).value = v;
document.getElementById(â€˜personalValâ€™).textContent = v;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SAVE ACTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveTransit() {
showToast(â€˜âœ… Transit erfolgreich angelegtâ€™, â€˜greenâ€™);
closeModal(â€˜newTransitModalâ€™);
}
function saveRechnung() {
const nr = â€˜RG-2026-â€™ + String(Date.now()).slice(-3);
showToast(â€˜âœ… Rechnung â€™ + nr + â€™ erstelltâ€™, â€˜greenâ€™);
closeModal(â€˜newRechnungModalâ€™);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PRINT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function printForm() {
window.print();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT: SET DEFAULT DATES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initDates() {
const today = new Date().toISOString().substring(0,10);
const in30 = new Date(); in30.setDate(in30.getDate() + 30);
const in60 = new Date(); in60.setDate(in60.getDate() + 60);
const d = document.getElementById(â€˜bdDatumâ€™);
const b = document.getElementById(â€˜bdBeginnâ€™);
const e = document.getElementById(â€˜bdEndeâ€™);
if (d) d.value = today;
if (b) b.value = in30.toISOString().substring(0,10);
if (e) e.value = in60.toISOString().substring(0,10);
// Auto ID
const bdId = document.getElementById(â€˜bdIdâ€™);
if (bdId) bdId.value = â€˜BD-â€™ + String(Date.now()).slice(-5);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PERSONENTABELLE â€” Zeile hinzufÃ¼gen
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addPersonRow() {
const tbody = document.getElementById(â€˜personTableBodyâ€™);
const row = document.createElement(â€˜trâ€™);
row.innerHTML = `<td><input class="form-control" placeholder="Nachname" style="min-width:120px"></td> <td><input class="form-control" placeholder="Vorname" style="min-width:100px"></td> <td><input class="form-control" placeholder="P-${String(Date.now()).slice(-4)}" style="min-width:90px"></td> <td><select class="form-control" style="min-width:130px"> <option>ABT-1: Planung</option><option>ABT-2: Logistik</option> <option>ABT-3: Technik</option><option>ABT-4: Infrastruktur</option><option>ABT-5: Support</option> </select></td> <td><input class="form-control" placeholder="Funktion" style="min-width:110px"></td> <td><button class="btn btn-danger btn-sm" onclick="this.closest('tr').remove()">âœ•</button></td>`;
tbody.appendChild(row);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FAHRZEUGTABELLE â€” Typen, FlÃ¤chen, AnhÃ¤nger
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Fahrzeugtypen mit automatischer AbstellflÃ¤che und Zuladung
const _fzTypen = {
lkw: [
{ label:â€˜Standard-LKW (7,5t)â€™,  flaeche:42, zuladung:â€˜7,5tâ€™ },
{ label:â€˜LKW 15tâ€™,              flaeche:50, zuladung:â€˜15tâ€™  },
{ label:â€˜Schwerlast-LKW (40t)â€™, flaeche:56, zuladung:â€˜40tâ€™  },
{ label:â€˜KÃ¼hlfahrzeugâ€™,         flaeche:45, zuladung:â€˜variabelâ€™ },
{ label:â€˜Tankfahrzeugâ€™,         flaeche:48, zuladung:â€˜variabelâ€™ },
{ label:â€˜Sattelzugâ€™,            flaeche:70, zuladung:â€˜25tâ€™  },
],
pkw: [
{ label:â€˜Standard PKWâ€™,            flaeche:8,  zuladung:â€˜5 Paxâ€™ },
{ label:â€˜GelÃ¤ndefahrzeug (SUV)â€™,    flaeche:9,  zuladung:â€˜5 Paxâ€™ },
{ label:â€˜Limousineâ€™,               flaeche:9,  zuladung:â€˜4 Paxâ€™ },
{ label:â€˜Kombiâ€™,                   flaeche:9,  zuladung:â€˜5 Pax + GepÃ¤ckâ€™ },
],
bus: [
{ label:â€˜Minibus (9 Pax)â€™,    flaeche:14, zuladung:â€˜9 Paxâ€™  },
{ label:â€˜Reisebus (50 Pax)â€™, flaeche:40, zuladung:â€˜50 Paxâ€™ },
{ label:â€˜Gelenkbusâ€™,         flaeche:55, zuladung:â€˜120 Paxâ€™},
],
container: [
{ label:â€˜20-FuÃŸ-Standardâ€™,   flaeche:14, zuladung:â€˜22tâ€™ },
{ label:â€˜40-FuÃŸ-Standardâ€™,   flaeche:28, zuladung:â€˜26tâ€™ },
{ label:â€˜BÃ¼rocontainerâ€™,     flaeche:14, zuladung:â€™â€”â€™   },
{ label:â€˜Schlafcontainerâ€™,   flaeche:14, zuladung:â€™â€”â€™   },
{ label:â€˜SanitÃ¤rcontainerâ€™,  flaeche:14, zuladung:â€™â€”â€™   },
],
transporter: [
{ label:â€˜Kleintransporter (3,5t)â€™, flaeche:12, zuladung:â€˜3,5tâ€™ },
{ label:â€˜GroÃŸraumtransporterâ€™,     flaeche:15, zuladung:â€˜5tâ€™   },
{ label:â€˜Sprinterâ€™,                flaeche:12, zuladung:â€˜3tâ€™   },
]
};

const _anhaengerFlaeche = { â€˜0â€™:0, â€˜20â€™:20, â€˜30â€™:30, â€˜40â€™:40, â€˜14â€™:14, â€˜28â€™:28 };

function _buildTypOptions(kat) {
return (_fzTypen[kat] || []).map(t =>
`<option value="${t.label}" data-flaeche="${t.flaeche}" data-zuladung="${t.zuladung}">${t.label}</option>`
).join(â€™â€™);
}

function _isLkw(kat) { return kat === â€˜lkwâ€™; }

function updateFahrzeugTyp(katSelect) {
const row = katSelect.closest(â€˜trâ€™);
const kat = katSelect.value;
const typSelect = row.querySelector(â€™.fz-typ-selectâ€™);
const anhaengerCell = row.querySelector(â€™.fz-anhaenger-cellâ€™);

typSelect.innerHTML = _buildTypOptions(kat);
// Show/hide AnhÃ¤nger only for LKW
if (anhaengerCell) anhaengerCell.style.display = _isLkw(kat) ? â€˜â€™ : â€˜noneâ€™;
// Trigger auto-fill
autoFlaeche(typSelect);
}

function autoFlaeche(typSelect) {
const row = typSelect.closest(â€˜trâ€™);
const opt = typSelect.options[typSelect.selectedIndex];
const basisFlaeche = parseFloat(opt.dataset.flaeche) || 0;
const zuladung = opt.dataset.zuladung || â€˜â€™;

// AnhÃ¤nger
const anhaengerSel = row.querySelector(â€™.fz-anhaengerâ€™);
const anhaengerZusatz = anhaengerSel ? (_anhaengerFlaeche[anhaengerSel.value] || 0) : 0;

const total = basisFlaeche + anhaengerZusatz;
const flaecheInput = row.querySelector(â€™.fz-flaecheâ€™);
const zuladungInput = row.querySelector(â€™.fz-zuladungâ€™);

if (flaecheInput) { flaecheInput.value = total; flaecheInput.style.color = â€˜var(â€“amber)â€™; }
if (zuladungInput) { zuladungInput.value = zuladung; zuladungInput.style.color = â€˜var(â€“amber)â€™; }
updateGesamtflaeche();
}

function _makeRow(kat=â€˜lkwâ€™) {
const isLkw = _isLkw(kat);
const typen = _buildTypOptions(kat);
return `<td><select class="form-control fz-kat-select" style="min-width:120px" onchange="updateFahrzeugTyp(this)"> <option value="lkw" ${kat==='lkw'?'selected':''}>ğŸš› LKW</option> <option value="pkw" ${kat==='pkw'?'selected':''}>ğŸš— PKW</option> <option value="bus" ${kat==='bus'?'selected':''}>ğŸšŒ Bus</option> <option value="container" ${kat==='container'?'selected':''}>ğŸ“¦ Container</option> <option value="transporter" ${kat==='transporter'?'selected':''}>ğŸš Transporter</option> </select></td> <td><input class="form-control" placeholder="B-AB 1234" style="min-width:110px"></td> <td><select class="form-control fz-typ-select" style="min-width:175px" onchange="autoFlaeche(this)">${typen}</select></td> <td><input class="form-control fz-zuladung" placeholder="auto" style="min-width:80px;color:var(--amber)" readonly></td> <td class="fz-anhaenger-cell" style="display:${isLkw?'':'none'}"> <select class="form-control fz-anhaenger" style="min-width:180px" onchange="autoFlaeche(this.closest('tr').querySelector('.fz-typ-select'))"> <option value="0">â€” Kein AnhÃ¤nger</option> <option value="20">EinachsanhÃ¤nger (+20 mÂ²)</option> <option value="30">TandemanhÃ¤nger (+30 mÂ²)</option> <option value="40">Sattelauflieger (+40 mÂ²)</option> <option value="14">Container-Anh. 20ft (+14 mÂ²)</option> <option value="28">Container-Anh. 40ft (+28 mÂ²)</option> </select> </td> <td><input class="form-control fz-flaeche" type="number" placeholder="auto" style="min-width:75px;color:var(--amber)" oninput="updateGesamtflaeche()"></td> <td><select class="form-control" style="min-width:115px"> <option>Kein ADR</option><option>ADR Klasse 1</option> <option>ADR Klasse 2</option><option>ADR Klasse 3</option><option>ADR Klasse 7</option> </select></td> <td><button class="btn btn-danger btn-sm" onclick="this.closest('tr').remove(); updateGesamtflaeche()">âœ•</button></td>`;
}

function addFahrzeugRow() {
const tbody = document.getElementById(â€˜fahrzeugTableBodyâ€™);
const row = document.createElement(â€˜trâ€™);
row.innerHTML = _makeRow(â€˜lkwâ€™);
tbody.appendChild(row);
// Auto-fill first row
const typSel = row.querySelector(â€™.fz-typ-selectâ€™);
if (typSel) autoFlaeche(typSel);
updateGesamtflaeche();
}

function updateGesamtflaeche() {
const inputs = document.querySelectorAll(â€™#fahrzeugTableBody .fz-flaecheâ€™);
let total = 0;
inputs.forEach(i => { total += parseFloat(i.value)||0; });
const el = document.getElementById(â€˜gesamtFlaecheâ€™);
const cnt = document.getElementById(â€˜fahrzeugCountâ€™);
if (el) el.textContent = total.toFixed(0) + â€™ mÂ²â€™;
if (cnt) cnt.textContent = document.querySelectorAll(â€™#fahrzeugTableBody trâ€™).length;
}

// Init first row on page load
document.addEventListener(â€˜DOMContentLoadedâ€™, () => {
const firstTyp = document.querySelector(â€™#fahrzeugTableBody .fz-typ-selectâ€™);
if (firstTyp) setTimeout(() => autoFlaeche(firstTyp), 100);
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DOWNLOAD â€” App als HTML-Datei speichern
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function downloadApp() {
const html = â€˜<!DOCTYPE html>\nâ€™ + document.documentElement.outerHTML;
const blob = new Blob([html], { type: â€˜text/html;charset=utf-8â€™ });
const file = new File([blob], â€˜OPS360.htmlâ€™, { type: â€˜text/htmlâ€™ });
const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

// â”€â”€ Methode 1: Web Share API mit File (iOS 15+ Safari) â”€â”€
if (isIOS && navigator.canShare && navigator.canShare({ files: [file] })) {
try {
await navigator.share({
files: [file],
title: â€˜OPS360â€™,
text: â€˜OPS360 Global Operations Managementâ€™
});
showToast(â€˜âœ… Speicherdialog geÃ¶ffnetâ€™, â€˜greenâ€™);
return;
} catch(e) {
if (e.name !== â€˜AbortErrorâ€™) {
// Share failed â€” fall through to next method
} else {
return; // User cancelled
}
}
}

// â”€â”€ Methode 2: Desktop / Android Download â”€â”€
if (!isIOS) {
const url = URL.createObjectURL(blob);
const a = document.createElement(â€˜aâ€™);
a.href = url;
a.download = â€˜OPS360.htmlâ€™;
document.body.appendChild(a);
a.click();
setTimeout(() => { URL.revokeObjectURL(url); a.remove(); }, 1000);
showToast(â€˜ğŸ“¥ OPS360.html wird gespeichertâ€¦â€™, â€˜amberâ€™);
return;
}

// â”€â”€ Methode 3: iOS Fallback â€” neuer Tab mit Speicher-Anleitung â”€â”€
const url = URL.createObjectURL(blob);
const newTab = window.open(url, â€˜_blankâ€™);
if (newTab) {
showToast(â€˜ğŸ“‹ Teilen â†‘ â†’ â€In Dateien sichernâ€ antippenâ€™, â€˜amberâ€™);
} else {
openModal(â€˜saveModalâ€™);
document.getElementById(â€˜saveContentâ€™).value = html;
}
}

function openInNewTab() {
const html = â€˜<!DOCTYPE html>\nâ€™ + document.documentElement.outerHTML;
const blob = new Blob([html], { type: â€˜text/html;charset=utf-8â€™ });
const url = URL.createObjectURL(blob);
window.open(url, â€˜_blankâ€™);
showToast(â€˜ğŸ“‹ Teilen â†‘ â†’ In Dateien sichernâ€™, â€˜amberâ€™);
}

function copySaveContent() {
const ta = document.getElementById(â€˜saveContentâ€™);
if (!ta.value) {
const html = â€˜<!DOCTYPE html>\nâ€™ + document.documentElement.outerHTML;
ta.value = html;
}
ta.select();
try {
document.execCommand(â€˜copyâ€™);
showToast(â€˜âœ… Code kopiert! In Notizen einfÃ¼gen & als .html speichernâ€™, â€˜greenâ€™);
} catch(e) {
navigator.clipboard.writeText(ta.value).then(() => {
showToast(â€˜âœ… Code kopiert!â€™, â€˜greenâ€™);
});
}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SERVICE WORKER REGISTRATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
if (â€˜serviceWorkerâ€™ in navigator) {
// SW registered inline above
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PWA INSTALL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let deferredPrompt;
window.addEventListener(â€˜beforeinstallpromptâ€™, (e) => {
e.preventDefault(); deferredPrompt = e;
const btn = document.createElement(â€˜buttonâ€™);
btn.className = â€˜topbar-btnâ€™;
btn.textContent = â€˜ğŸ“± App installierenâ€™;
btn.onclick = async () => { deferredPrompt.prompt(); btn.remove(); };
document.querySelector(â€™.topbar-rightâ€™).prepend(btn);
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BOOTSTRAP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener(â€˜DOMContentLoadedâ€™, () => {
renderDashboard();
renderPhase2();
renderTransit();
renderServices();
renderPersonal();
renderTransport();
renderAbrechnung();
renderPartner();
renderVorlagen();
renderAbteilungen();
initDates();
showStep(1);

// Mobile sidebar
if (window.innerWidth <= 900) {
document.getElementById(â€˜menuBtnâ€™).style.display = â€˜blockâ€™;
}
});
</script>

</body>
</html>